# –ê–Ω–∞–ª–∏–∑ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
_Exported on 31.10.2025 at 15:13:28 GMT+4 from Cursor (2.0.43)_

---

**User**

—Å–µ–π—á–∞—Å —è —Ö–æ—á—É –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä. –¥–ª—è –Ω–∞—á–∞–ª–∞ —è —Ç–µ–±–µ –ø—Ä–∏—à–ª—é –∫–æ–¥ —Å–≤–æ–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Å –¥—Ä—É–≥–æ–≥–æ —Å–∞–π—Ç–∞) –∏ –Ω–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –µ–≥–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å. —Å–¥–µ–ª–∞–π –µ–≥–æ –∞–Ω–∞–ª–∏–∑, –Ω–∞–π–¥–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—á–∞–ª–∞ (—á—Ç–æ–±—ã –∏—Ö –±–µ–∑–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ —É–¥–∞–ª–∏—Ç—å). –∑–∞—Ç–µ–º –ø—Ä–µ–¥–ª–æ–∂–∏ —É–ª—É—á—à–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞. –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ–Ω —Å—á–∏—Ç–∞–µ—Ç –≤—Å–µ –≤–µ—Ä–Ω–æ. –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–ª–æ–∂–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ –Ω–µ –≤–Ω–æ—Å–∏ –∏—Ö. @README-RU.md @PROGRESS.md @–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Ä—Å–∏—è –ø–æ—Å–ª–µ–¥–Ω—è—è.txt 

---

**Cursor**


–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∫–æ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞. –ò–∑—É—á–∞—é —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä—è—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.


–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—è—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∏—â—É –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥.


–ê–Ω–∞–ª–∏–∑ –≥–æ—Ç–æ–≤. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

### 1. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `currentStep` (—Å—Ç—Ä–æ–∫–∞ 765, 917, 936) ‚Äî –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è; –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.

#### –§—É–Ω–∫—Ü–∏–∏/–¥–∞–Ω–Ω—ã–µ:
- `priceText` (—Å—Ç—Ä–æ–∫–∞ 573) ‚Äî —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç–∏—á–µ–Ω.
- `additionalInfo` (—Å—Ç—Ä–æ–∫–∏ 951, 957, 963, 969, 979) ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ `calculateDetailed()`, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `calculationData`, –Ω–æ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ.
- `console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞')` (—Å—Ç—Ä–æ–∫–∞ 1082) ‚Äî —É–¥–∞–ª–∏—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

#### –ú–∞–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- –ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω `'samara'` –≤ —Å—Ç—Ä–æ–∫–∞—Ö 940, 1028 ‚Äî —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–º.

---

### 2. –ü—Ä–æ–±–ª–µ–º—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è

#### A. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ `submitForm()`:
   - –ú–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è `document.getElementById()` ‚Äî —Å–æ–∑–¥–∞—Ç—å helper-—Ñ—É–Ω–∫—Ü–∏—é.
2. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞:
   - `0.625`, `0.25` (—Ä–∞–∑–º–µ—Ä—ã –±–ª–æ–∫–æ–≤) ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.
   - `1.05` (5% –∑–∞–ø–∞—Å), `25` (–∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥), `0.75` (—à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è) ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.
3. –ò–Ω–ª–∞–π–Ω-—Å—Ç–∏–ª–∏:
   - –ú–Ω–æ–≥–æ –∏–Ω–ª–∞–π–Ω-—Å—Ç–∏–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç—Ä–æ–∫–∏ 465, 624, 654, 678) ‚Äî –≤—ã–Ω–µ—Å—Ç–∏ –≤ CSS –∫–ª–∞—Å—Å—ã –∏–ª–∏ Tailwind (—Å —É—á–µ—Ç–æ–º Next.js).

#### B. UX –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞:
   - –°–ª–∞–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª–∏–Ω–∞ > 10) ‚Äî —É—Å–∏–ª–∏—Ç—å.
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ localStorage, JSON.parse, fetch ‚Äî –¥–æ–±–∞–≤–∏—Ç—å try-catch.
6. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞, –ª—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π loader.

#### C. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

7. –ß–∞—Å—Ç—ã–µ –≤—ã–∑–æ–≤—ã `saveToStorage()`:
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å debounce.
8. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `querySelector`:
   - –í `submitForm()` ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã.
9. Event listeners:
   - –ú–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–ª—É—à–∞—Ç–µ–ª–µ–π ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π.

#### D. –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –∏ –¥–∏–∑–∞–π–Ω

10. –¶–≤–µ—Ç–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–æ–µ–∫—Ç—É:
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `#FFCF33`, `#3b82f6`, –Ω–æ –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `#EA580C` (orange-600) –∏ —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –¥–ª—è header.
    - –°–∏–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞.

#### E. –ö–æ–¥-—Å—Ç–∏–ª—å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

11. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
    - –ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤ `submitForm()` (—Å—Ç—Ä–æ–∫–∏ 984-1099).
12. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
    - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å—á–µ—Ç–∞–º (—Ñ—Ä–æ–Ω—Ç–æ–Ω—ã, –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏).
13. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏:
    - –í–µ—Å—å JS –≤ –æ–¥–Ω–æ–º –±–ª–æ–∫–µ ‚Äî —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ React).

---

### 3. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

#### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (–±–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞):

1. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`currentStep`).
2. –£–±—Ä–∞—Ç—å `console.log`.
3. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ).
4. –î–æ–±–∞–≤–∏—Ç—å try-catch –¥–ª—è localStorage –∏ fetch.
5. –ó–∞–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ (orange-600 –≤–º–µ—Å—Ç–æ –∂–µ–ª—Ç–æ–≥–æ, navy –¥–ª—è header).
6. –í—ã–Ω–µ—Å—Ç–∏ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞.

#### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (—Å –Ω–µ–±–æ–ª—å—à–∏–º —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º):

7. –î–æ–±–∞–≤–∏—Ç—å debounce –¥–ª—è `saveToStorage()` (300-500ms).
8. –°–æ–∑–¥–∞—Ç—å helper-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –æ–ø–µ—Ä–∞—Ü–∏–π:
   ```javascript
   const getElement = (id) => document.getElementById(id);
   const getValue = (id) => getElement(id)?.value || '';
   ```
9. –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å DOM-—ç–ª–µ–º–µ–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö `getElementById`.
10. –£–ª—É—á—à–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É: —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é (calculations, storage, UI).

#### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (–ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –≤ React/Next.js):

11. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –∫–∞–∫ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - `CalculatorForm`, `Modal`, `StepIndicator`, `FormSteps`.
12. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
13. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Tailwind CSS –≤–º–µ—Å—Ç–æ –∏–Ω–ª–∞–π–Ω-—Å—Ç–∏–ª–µ–π.
14. –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏:
    - `calculatorLogic.ts` ‚Äî —Ä–∞—Å—á–µ—Ç—ã
    - `storage.ts` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å localStorage
    - `validation.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è
    - `api.ts` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

### 4. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ –∫–æ–¥—É

#### –°—Ç—Ä–æ–∫–∞ 954: —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è
```javascript
const glueAmount = Math.ceil((volumeWithReserve * 25) / 25);
```
–ü—Ä–æ–±–ª–µ–º–∞: –¥–µ–ª–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ —á–∏—Å–ª–æ. –í–µ—Ä–æ—è—Ç–Ω–æ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ `Math.ceil(volumeWithReserve * 25 / 25)` –∏–ª–∏ —Ä–∞—Å—á–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å.

#### –°—Ç—Ä–æ–∫–∞ 890: —Ä–∞–∑–º–µ—Ä—ã –±–ª–æ–∫–∞
```javascript
const blocksCount = Math.ceil(volumeWithReserve / (0.625 * 0.25 * (thickness / 1000)));
```
–ü—Ä–æ–±–ª–µ–º–∞: —Ä–∞–∑–º–µ—Ä—ã –±–ª–æ–∫–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã (625x250 –º–º). –õ—É—á—à–µ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏.

#### –°—Ç—Ä–æ–∫–∞ 881: —Ä–∞—Å—á–µ—Ç —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤
```javascript
const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));
```
–§–æ—Ä–º—É–ª–∞ –¥–ª—è —Ç—Ä–µ—É–≥–æ–ª—å–Ω–æ–≥–æ —Ñ—Ä–æ–Ω—Ç–æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. –£–¥–∞–ª–∏—Ç—å `currentStep`
2. –£–±—Ä–∞—Ç—å `console.log`
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è (—Å—Ç—Ä–æ–∫–∞ 954)
4. –ó–∞–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
5. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ localStorage

–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
6. –í—ã–Ω–µ—Å—Ç–∏ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
7. –î–æ–±–∞–≤–∏—Ç—å debounce –¥–ª—è `saveToStorage()`
8. –£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞
9. –°–æ–∑–¥–∞—Ç—å helper-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è DOM

–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
10. –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ä–∞—Å—á–µ—Ç–∞–º
11. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ React)

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ –≤–Ω–µ—Å–µ–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π. –° –∫–∞–∫–æ–π —á–∞—Å—Ç–∏ –Ω–∞—á–∞—Ç—å?

```javascript
   const getElement = (id) => document.getElementById(id);
   const getValue = (id) => getElement(id)?.value || '';
```

```javascript
const glueAmount = Math.ceil((volumeWithReserve * 25) / 25);
```

```javascript
const blocksCount = Math.ceil(volumeWithReserve / (0.625 * 0.25 * (thickness / 1000)));
```

```javascript
const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));
```

---

**User**

–æ—Ç–ª–∏—á–Ω–æ. –¥–µ–ª–∞–µ–º –≤—Å–µ –ø—Ä–∞–≤–∫–∏ –∏–∑ –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞. –ø—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –±–∞–≥–æ–≤. –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É. –∑–∞—Ç–µ–º, –µ—Å–ª–∏ –±–∞–≥–æ–≤ –Ω–µ—Ç, –º–µ–Ω—è–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É –Ω–∞—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ /calculator –Ω–∞ –Ω–æ–≤—ã–π, –∫–æ—Ç–æ—Ä—ã–π –º—ã –∑–¥–µ—Å—å —Å–æ–∑–¥–∞–¥–∏–º. –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —Å—Ç—Ä–∞–Ω–∏—á–∫—É –Ω—É–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —á—Ç–æ–±—ã –≤—Å–µ –≤ –∏—Ç–æ–≥–µ –≤—ã–≥–ª—è–¥–µ–ª–æ —Ä–æ–≤–Ω–æ, –∫—Ä–∞—Å–∏–≤–æ, –≤ —Ç–æ–º —á–∏—Å–ª–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏. 

---

**Cursor**


–ò–∑—É—á–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ç–µ–∫—É—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–º —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.


–°–æ–∑–¥–∞—é —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞. –ó–∞—Ç–µ–º —Å–æ–∑–¥–∞–º —Ñ–∞–π–ª —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏ –∏ –∑–∞–º–µ–Ω—é —Ç–µ–∫—É—â–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä.


–°–æ–∑–¥–∞—é —É–ª—É—á—à–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞ React —Å TypeScript –∏ –≤—Å–µ–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  useEffect(() => {
    if (formData.perimeter) {
      return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–∞–ø—Ä—è–º—É—é
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    }
  }, [formData.houseLength, formData.houseWidth]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
      if (field === 'perimeter') {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    return digits.length === 10 || (digits.length === 11 && digits.startsWith('7'));
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–ª–µ—è
      const glueAmount = Math.ceil((result.volume * CALCULATION_CONSTANTS.GLUE_PER_M3) / CALCULATION_CONSTANTS.GLUE_PER_M3);
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–°–æ–∑–¥–∞—é —Ñ–∞–π–ª —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è—é –æ—à–∏–±–∫–∏:


```markdown
# –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ –ø–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `currentStep` (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å)
- ‚úÖ –£–±—Ä–∞–Ω `console.log` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è (—É–±—Ä–∞–Ω–æ –¥–µ–ª–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ —á–∏—Å–ª–æ)
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã —Ü–≤–µ—Ç–∞ –Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ (orange-600, navy –¥–ª—è header)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage (try-catch)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- ‚úÖ –í—ã–Ω–µ—Å–µ–Ω—ã –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`CALCULATION_CONSTANTS`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debounce –¥–ª—è `saveToStorage()` (500ms)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã)
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã helper-—Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ React)
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ useState –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö getElementById

---

## üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 1. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–ª–æ–∂–Ω—ã–º —Ä–∞—Å—á–µ—Ç–∞–º:
  - –†–∞—Å—á–µ—Ç —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ (—Ñ–æ—Ä–º—É–ª–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞)
  - –†–∞—Å—á–µ—Ç –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ—á–µ–º—É —à–∞–≥ 0.75–º, –ø–æ—á–µ–º—É 2 —Ä—è–¥–∞)
  - –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –æ–±—ä–µ–º–∞ –±–ª–æ–∫–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- [ ] –°–æ–∑–¥–∞—Ç—å README –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ñ–æ—Ä–º—É–ª

### 2. –£–ª—É—á—à–µ–Ω–∏–µ UX
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–Ω–¥–∏–∫–∞—Ü–∏—é –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ (skeleton loader)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞—Å—á–µ—Ç–∞ –≤ PDF –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ç—è–∂–µ–ª—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é `useMemo`
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- [ ] Lazy loading –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞

### 4. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- [ ] –°–¥–µ–ª–∞—Ç—å —Ä–µ–≥–∏–æ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ IP –∏–ª–∏ –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –≤ `REGION_PRICES`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π (min/max –∑–Ω–∞—á–µ–Ω–∏—è)
- [ ] –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥ –ø–æ–ª—è–º–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
- [ ] Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞—Å—á–µ—Ç–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Ñ–æ—Ä–º—ã
- [ ] E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ flow

### 7. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (a11y)
- [ ] –î–æ–±–∞–≤–∏—Ç—å ARIA-–º–µ—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- [ ] –£–ª—É—á—à–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É screen readers
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–æ–≤

### 8. –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (< 320px)
- [ ] –î–æ–±–∞–≤–∏—Ç—å swipe –∂–µ—Å—Ç—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### 9. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π (Google Analytics, Yandex Metrika)
- [ ] –¢—Ä–µ–∫–∏–Ω–≥ –∫–æ–Ω–≤–µ—Ä—Å–∏–π –ø–æ —à–∞–≥–∞–º —Ñ–æ—Ä–º—ã
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã

### 10. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–±—É–¥—É—â–µ–µ)
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
  - `CalculatorForm` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞
  - `AdvancedParams` ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  - `CalculationModal` ‚Äî –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  - `ModalSteps` ‚Äî —à–∞–≥–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  - `ResultsDisplay` ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ö—É–∫ `useCalculator`
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
- [ ] –í—ã–Ω–µ—Å—Ç–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —É–∂–µ –≤–Ω–µ—Å–µ–Ω—ã
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ó–∞–¥–∞—á–∏ –Ω–∏–∑–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

```

–û—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞ –Ω–µ—Ç. –ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–¥ –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä—É—é –∫–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏:


–ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–¥ –Ω–∞ –±–∞–≥–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ä–∞—Å—á–µ—Ç—ã:


–ò—Å–ø—Ä–∞–≤–ª—è—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞: –æ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤–º–µ—Å—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–∏—Ñ—Ä.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  useEffect(() => {
    if (formData.perimeter) {
      return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–∞–ø—Ä—è–º—É—é
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    }
  }, [formData.houseLength, formData.houseWidth]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
      if (field === 'perimeter') {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–ª–µ—è
      const glueAmount = Math.ceil((result.volume * CALCULATION_CONSTANTS.GLUE_PER_M3) / CALCULATION_CONSTANTS.GLUE_PER_M3);
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:


–ò—Å–ø—Ä–∞–≤–ª—è—é —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è: —Å–µ–π—á–∞—Å –¥–µ–ª–µ–Ω–∏–µ –∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ —á–∏—Å–ª–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ ‚Äî –æ–±—ä–µ–º √ó —Ä–∞—Å—Ö–æ–¥ –∫–ª–µ—è –Ω–∞ –º¬≥ / –≤–µ—Å –º–µ—à–∫–∞.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  useEffect(() => {
    if (formData.perimeter) {
      return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–∞–ø—Ä—è–º—É—é
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    }
  }, [formData.houseLength, formData.houseWidth]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
      if (field === 'perimeter') {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏–∫—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π –ø—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞:


–ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–±–æ—Ç—É —Å –ø–µ—Ä–∏–º–µ—Ç—Ä–æ–º: –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –µ–≥–æ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã, –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã. –£–ª—É—á—à–∞—é –ª–æ–≥–∏–∫—É:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  useEffect(() => {
    if (formData.perimeter) {
      return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º, –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–∞–ø—Ä—è–º—É—é
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    }
  }, [formData.houseLength, formData.houseWidth]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç:

## –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
1. –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `currentStep`
2. –£–±—Ä–∞–Ω—ã `console.log` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è (—Ñ–æ—Ä–º—É–ª–∞ —É–ø—Ä–æ—â–µ–Ω–∞ –¥–æ `Math.ceil(result.volume)`)
4. –ó–∞–º–µ–Ω–µ–Ω—ã —Ü–≤–µ—Ç–∞ –Ω–∞ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ (orange-600, navy-900/700 –¥–ª—è header)
5. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage —á–µ—Ä–µ–∑ try-catch

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
6. –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (`CALCULATION_CONSTANTS`)
7. –î–æ–±–∞–≤–ª–µ–Ω debounce (500ms) –¥–ª—è `saveToStorage()`
8. –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–∏—Ñ—Ä)
9. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã React hooks –∏ TypeScript –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö DOM-–æ–ø–µ—Ä–∞—Ü–∏–π
10. –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ `handleFieldChange`

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `CALCULATOR_TODO.md` —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏ –Ω–∏–∑–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–∏–Ω—Ç–µ—Ä-–æ—à–∏–±–∫–∏ ‚Äî –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- –ö–æ–¥ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å—Ç–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —à–∞–≥–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage —Å debounce

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏
1. –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ –∫–ª–µ—è —É–ø—Ä–æ—â–µ–Ω–∞
2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–∏—Ñ—Ä)
3. –£–±—Ä–∞–Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `handleFieldChange`

–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, –∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –æ—à–∏–±–∫–∏, –¥–∏–∑–∞–π–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

---

**User**

–¥–æ—Ä–∞–±–æ—Ç–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –ø–æ—è–≤–∏–ª–∏—Å—å –æ—à–∏–±–∫–∏. –µ—Å–ª–∏ —è –≤–≤–æ–∂—É –¥–∞–Ω–Ω—ã–µ –≤ —à–∏—Ä–∏–Ω—É –∏ –¥–ª–∏–Ω—É –¥–æ–º–∞, —Ç–æ –º–µ–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ—Ç –≤ –æ–±—â—É—é –¥–ª–∏–Ω—É —Å—Ç–µ–Ω –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. 

---

**Cursor**


–ò—Å–ø—Ä–∞–≤–ª—è—é –∞–≤—Ç–æ–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞: –æ–Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ñ–æ–∫—É—Å –∏ –º–µ—à–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É/—à–∏—Ä–∏–Ω—É. –î–µ–ª–∞—é –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (onBlur).


–ò—Å–ø—Ä–∞–≤–ª—è—é –∞–≤—Ç–æ–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞: –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (onBlur), –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (formData.perimeter && isLengthWidthDisabled) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä
      setFormData((prev) => ({ ...prev, perimeter: '' }));
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter, isLengthWidthDisabled]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (formData.perimeter && isLengthWidthDisabled) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä
      setFormData((prev) => ({ ...prev, perimeter: '' }));
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter, isLengthWidthDisabled]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (formData.perimeter && isLengthWidthDisabled) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä
      setFormData((prev) => ({ ...prev, perimeter: '' }));
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter, isLengthWidthDisabled]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–ò—Å–ø—Ä–∞–≤–ª—è—é –ª–æ–≥–∏–∫—É: `isLengthWidthDisabled` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `formData.perimeter`, –∞ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è. –ò—Å–ø—Ä–∞–≤–ª—è—é –ø—Ä–æ–≤–µ—Ä–∫—É:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é –ª–æ–≥–∏–∫—É: –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è.


–ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–±–æ—Ç—É: –ø–µ—Ä–∏–º–µ—Ç—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (onBlur), –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤–≤–æ–¥–µ. –î–æ–±–∞–≤–ª—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–∏—Å—Ç–∫–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π.


–ò—Å–ø—Ä–∞–≤–∏–ª –ø—Ä–æ–±–ª–µ–º—É.

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. –£–±—Ä–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ —á–µ—Ä–µ–∑ `useEffect` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏–ª–æ —Ñ–æ–∫—É—Å –∏ –º–µ—à–∞–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculatePerimeter`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã—á–∏—Å–ª—è–µ—Ç –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ (`onBlur`) –ø–æ–ª–µ–π –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã.
3. –õ–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–º –ø–µ—Ä–∏–º–µ—Ç—Ä–µ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è; –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ ‚Äî —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.

–¢–µ–ø–µ—Ä—å:
- –ú–æ–∂–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—è "–î–ª–∏–Ω–∞ –¥–æ–º–∞" –∏ "–®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞".
- –ü–µ—Ä–∏–º–µ—Ç—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ —Å –ø–æ–ª—è (–ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞).
- –§–æ–∫—É—Å –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ.

–ú–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É, –ø–µ—Ä–∏–º–µ—Ç—Ä –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –≤—ã –∑–∞–∫–æ–Ω—á–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–π–¥–µ—Ç–µ –∫ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—é.

---

**User**

–¥–∞–≤–∞–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ —Å–¥–µ–ª–∞–µ–º –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ - –æ–Ω —Å–ª–∏—à–∫–æ–º –∫–∏—Å–ª–æ—Ç–Ω—ã–º —Å–º–æ—Ç—Ä–∏—Ç—Å—è.

---

**Cursor**


–ò—â—É –∏ –∑–∞–º–µ–Ω—è—é –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –Ω–∞ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç.


–ó–∞–º–µ–Ω—è—é –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –Ω–∞ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        <div className="max-w-3xl mx-auto">
          {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
          <div className="text-center mb-8 md:mb-12">
            <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
              –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
            </h1>
            <p className="text-base md:text-lg text-gray-600">
              –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
            </p>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

–ó–∞–º–µ–Ω–∏–ª –≤—Å–µ –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –Ω–∞ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç. –ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ:


–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω—ã `bg-gradient-to-r from-orange-600 to-orange-700` –Ω–∞ `bg-orange-600`
- –ó–∞–º–µ–Ω–µ–Ω—ã `hover:from-orange-700 hover:to-orange-800` –Ω–∞ `hover:bg-orange-700`

**–ì–¥–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ:**
1. –ö–Ω–æ–ø–∫–∞ "üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞)
2. –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ ‚Üí" (—à–∞–≥ 1 –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
3. –ö–Ω–æ–ø–∫–∞ "–î–∞–ª–µ–µ ‚Üí" (—à–∞–≥ 2 –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
4. –ö–Ω–æ–ø–∫–∞ "üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç" (—à–∞–≥ 3 –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
5. –ö–Ω–æ–ø–∫–∞ "–û—Ç–ª–∏—á–Ω–æ!" (—ç–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞)

–¢–µ–ø–µ—Ä—å –æ—Ä–∞–Ω–∂–µ–≤—ã–π –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π: `bg-orange-600` —Å `hover:bg-orange-700`. –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ —Å—Ç–∞–ª —Å–ø–æ–∫–æ–π–Ω–µ–µ.

---

**User**

–æ—Ç–ª–∏—á–Ω–æ. —Ç–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–º –ø–µ—Ä–µ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º –∏–ª–∏ —Å–±–æ–∫—É –æ—Ç –Ω–µ–≥–æ - –∫–∞–∫ –±—É–¥–µ—Ç –∫—Ä–∞—Å–∏–≤–µ–µ? —Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–æ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º. –Ω–æ –∑–∞ –æ—Å–Ω–æ–≤—É –≤–∑—è—Ç—å —Ç–æ, —á—Ç–æ –±—ã–ª–æ. –≤–∞–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π, –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é. –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤–æ.

---

**Cursor**


–ò–∑—É—á–∞—é —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–Ω–µ—Å—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–µ—Ä–µ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º –∏ –æ–±–Ω–æ–≤–ª—é —Ç–µ–∫—Å—Ç –ø–æ–¥ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:


–†–∞–∑–º–µ—â–∞—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∏ —Å–≤–µ—Ä—Ö—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö. –û–±–Ω–æ–≤–ª—è—é —Ç–µ–∫—Å—Ç –ø–æ–¥ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.


–ü–µ—Ä–µ–Ω–æ—à—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∏ –æ–±–Ω–æ–≤–ª—è—é —Ç–µ–∫—Å—Ç:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-3 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-xl shadow-sm p-6 sticky top-6">
              <h2 className="text-xl font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-6">
                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      1
                    </span>
                    <span>–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω –Ω–∞–ø—Ä—è–º—É—é. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏
                    —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      2
                    </span>
                    <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏
                    –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Ä–∞—Å—á–µ—Ç —Ç–æ—á–Ω–µ–µ.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      3
                    </span>
                    <span>–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5%
                    –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-xs text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5% –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <br />
                  <span className="text-xs">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è,
                    –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏ –ø—Ä–∏—à–ª–µ–º
                    –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–º–µ—Ç—É.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-2">
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-3 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-xl shadow-sm p-6 sticky top-6">
              <h2 className="text-xl font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-6">
                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      1
                    </span>
                    <span>–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω –Ω–∞–ø—Ä—è–º—É—é. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏
                    —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      2
                    </span>
                    <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏
                    –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Ä–∞—Å—á–µ—Ç —Ç–æ—á–Ω–µ–µ.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      3
                    </span>
                    <span>–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5%
                    –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-xs text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5% –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <br />
                  <span className="text-xs">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è,
                    –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏ –ø—Ä–∏—à–ª–µ–º
                    –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–º–µ—Ç—É.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-2">
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */}
      <div className="container mx-auto px-4 pb-12">
        <div className="max-w-3xl mx-auto">
          <div className="bg-white rounded-xl shadow-sm p-6 md:p-8">
            <h2 className="text-xl md:text-2xl font-bold mb-6">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º?</h2>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    1
                  </span>
                  –ò–∑–º–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –£–∫–∞–∂–∏—Ç–µ –¥–ª–∏–Ω—É –∏ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω—ã –≤ –º–µ—Ç—Ä–∞—Ö. –î–ª—è —Ä–∞—Å—á–µ—Ç–∞ –≤—Å–µ–≥–æ –¥–æ–º–∞ —Å–ª–æ–∂–∏—Ç–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö
                  –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    2
                  </span>
                  –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–ª—â–∏–Ω—É —Å—Ç–µ–Ω—ã
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –î–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 300-400 –º–º –¥–ª—è –Ω–∞—Ä—É–∂–Ω—ã—Ö —Å—Ç–µ–Ω, 100-150 –º–º
                  –¥–ª—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    3
                  </span>
                  –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî 625x250 –º–º. –†–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è —É —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π.
                </p>
              </div>

              <div>
                <h3 className="font-semibold mb-3 flex items-center">
                  <span className="w-8 h-8 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-3 font-bold text-sm">
                    4
                  </span>
                  –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                </h3>
                <p className="text-gray-600 ml-11 text-sm">
                  –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç 5% –∑–∞–ø–∞—Å–∞ –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –±–æ–π –ø—Ä–∏
                  —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ.
                </p>
              </div>
            </div>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-4 md:p-6 rounded">
              <p className="font-semibold mb-2">üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:</p>
              <ul className="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>–ò–∑ —Ä–∞—Å—á–µ—Ç–∞ –∏—Å–∫–ª—é—á–µ–Ω—ã –¥–≤–µ—Ä–Ω—ã–µ –∏ –æ–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã ‚Äî —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —ç—Ç–æ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ</li>
                <li>–î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–∞—à–∏–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏</li>
                <li>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –∫–ª–µ–π –¥–ª—è –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (—Ä–∞—Å—Ö–æ–¥ ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏)</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-3 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1">
            <div className="bg-white rounded-xl shadow-sm p-6 sticky top-6">
              <h2 className="text-xl font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-6">
                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      1
                    </span>
                    <span>–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω –Ω–∞–ø—Ä—è–º—É—é. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏
                    —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      2
                    </span>
                    <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏
                    –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫. –≠—Ç–æ —Å–¥–µ–ª–∞–µ—Ç —Ä–∞—Å—á–µ—Ç —Ç–æ—á–Ω–µ–µ.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-center text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0">
                      3
                    </span>
                    <span>–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-xs ml-8">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5%
                    –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-xs text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5% –Ω–∞ –ø–æ–¥—Ä–µ–∑–∫—É</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥ –Ω–∞ 1 –º¬≥ –∫–ª–∞–¥–∫–∏</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-4">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <br />
                  <span className="text-xs">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è,
                    –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ. –ú—ã —Å–≤—è–∂–µ–º—Å—è —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏ –ø—Ä–∏—à–ª–µ–º
                    –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–º–µ—Ç—É.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-2">
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ì–æ—Ç–æ–≤–æ. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
   - –ù–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (lg+): –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (1:2)
   - –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–≤–µ—Ä—Ö—É, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–Ω–∏–∑—É
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è sticky –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ

2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
   - **–®–∞–≥ 1:** –£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã (–¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä, –≤—ã—Å–æ—Ç–∞, —Ç–æ–ª—â–∏–Ω–∞)
   - **–®–∞–≥ 2:** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ–∫–Ω–∞, –¥–≤–µ—Ä–∏, —Ñ—Ä–æ–Ω—Ç–æ–Ω—ã, –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏)
   - **–®–∞–≥ 3:** –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç —Å –∑–∞–ø–∞—Å–æ–º 5%)

3. **–£–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:**
   - –î–æ–±–∞–≤–ª–µ–Ω –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–π –±–ª–æ–∫ —Å –ø—Ä–∏–∑—ã–≤–æ–º –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
   - –£–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π, –∫–ª–µ–µ–º –∏ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –ê–∫—Ü–µ–Ω—Ç –Ω–∞ —É–¥–æ–±—Å—Ç–≤–æ —Å–≤—è–∑–∏ –∏ –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–º–µ—Ç—É

4. **–£–ª—É—á—à–µ–Ω–∏—è:**
   - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   - –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤–∞–∂–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (–ø—Ä–æ–µ–º—ã, –∑–∞–ø–∞—Å, –∫–ª–µ–π)

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞ —Ä—è–¥–æ–º —Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

---

**User**

–¥–∞–≤–∞–π –≤—Å–µ-—Ç–∞–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–±–æ–∫—É. –≤—Å–µ —Ä–∞–∑—ä–µ—Ö–∞–ª–æ—Å—å –æ—á–µ–Ω—å –Ω–µ–∫—Ä–∞—Å–∏–≤–æ.  –∏ —à—Ä–∏—Ñ—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –Ω—É–∂–µ–Ω

---

**Cursor**


–ò—Å–ø—Ä–∞–≤–ª—è—é layout –∏ —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤, —á—Ç–æ–±—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å —Å–±–æ–∫—É:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-2">
          <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden mb-6">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø—Ä–∞–≤–ª—è—é –∑–∞–∫—Ä—ã—Ç–∏–µ div:


```typescriptreact
          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∏ —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏ —Å–µ—Ç–∫–∏:
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: 1 –∫–æ–ª–æ–Ω–∫–∞ (lg:col-span-1)
   - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: 3 –∫–æ–ª–æ–Ω–∫–∏ (lg:col-span-3)
   - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 1:3

2. –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫: `text-lg`
   - –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ —à–∞–≥–æ–≤: `text-sm`
   - –û–ø–∏—Å–∞–Ω–∏—è: `text-sm` (–≤–º–µ—Å—Ç–æ `text-xs`)
   - –°–ø–∏—Å–æ–∫ "–í–∞–∂–Ω–æ": `text-sm` (–≤–º–µ—Å—Ç–æ `text-xs`)
   - –ë–ª–æ–∫ –æ –¥–µ—Ç–∞–ª—å–Ω–æ–º —Ä–∞—Å—á–µ—Ç–µ: `text-sm`

3. –ü–æ—Ä—è–¥–æ–∫ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö:
   - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–≤–µ—Ä—Ö—É (order-1)
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–Ω–∏–∑—É (order-2)

4. –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å:
   - –î–æ–±–∞–≤–ª–µ–Ω `leading-relaxed`
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –∏ padding
   - –£–ø—Ä–æ—â–µ–Ω —Ç–µ–∫—Å—Ç

–¢–µ–ø–µ—Ä—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ —à—Ä–∏—Ñ—Ç–æ–≤, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞, –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã.

---

**User**

–ø—Ä–æ–≤–µ—Ä—å –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ç–∞–º –æ—à–∏–±–∫–∞ "Parsing ecmascript source code failed

./app/calculator/page.tsx (864:9)

Parsing ecmascript source code failed

  862 |           </div>

  863 |         </div>

> 864 |       </div>

      |         ^^^

  865 |

  866 |       {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}

  867 |       {isModalOpen && (

Expected corresponding JSX closing tag for <main>

Import traces:

  Client Component Browser:

    ./app/calculator/page.tsx [Client Component Browser]

    ./app/calculator/page.tsx [Server Component]

  Client Component SSR:

    ./app/calculator/page.tsx [Client Component SSR]

    ./app/calculator/page.tsx [Server Component]"

---

**Cursor**


–ò—â—É –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–π —Ç–µ–≥ `<main>` –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ JSX:


–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É div'–æ–≤ –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 864:


–ò—Å–ø—Ä–∞–≤–ª—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ç–µ–≥–æ–≤:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö div'–æ–≤ –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ:


–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ:


–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ç–µ–≥–æ–≤, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—è –±–ª–æ–∫ –≤–æ–∫—Ä—É–≥ —Å—Ç—Ä–æ–∫–∏ 859:


–ò—Å–ø—Ä–∞–≤–ª—è—é JSX-—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –æ—à–∏–±–∫—É TypeScript:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout>();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-7xl mx-auto grid lg:grid-cols-4 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ò—Å–ø—Ä–∞–≤–∏–ª –¥–≤–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSX: –¥–æ–±–∞–≤–ª–µ–Ω –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π `</div>` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
2. TypeScript: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω `useRef` ‚Äî —Ç–µ–ø–µ—Ä—å `useRef<NodeJS.Timeout | undefined>(undefined)`.

–ü—Ä–æ–≤–µ—Ä—è—é, —á—Ç–æ –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:


–û—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSX** ‚Äî —É–±—Ä–∞–Ω –ª–∏—à–Ω–∏–π –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–π `</div>` –∏ –¥–æ–±–∞–≤–ª–µ–Ω –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π `</div>` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
2. **TypeScript** ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω `useRef<NodeJS.Timeout>()` –Ω–∞ `useRef<NodeJS.Timeout | undefined>(undefined)`.

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–µ–∫—Ç –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫, –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSX –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞.

---

**User**

—Ö–æ—Ä–æ—à–æ. —Ç–æ–ª—å–∫–æ –¥–∞–≤–∞–π –µ—â–µ –ø–æ–¥–ø—Ä–∞–≤–∏–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –±–ª–æ–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—á–∫–µ. —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–π, –Ω–µ–∫—Ä–∞—Å–∏–≤—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç—Å—è –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ.  –Ω—É–∂–Ω–æ —É–º–µ–Ω—å–±—à–∏—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –µ–≥–æ —Ä–∞–∑–º–µ—Ä—ã. 

---

**Cursor**


–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –≤–∏–¥–∞ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-5 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-3 order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-5 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-4 order-1 lg:order-2">
            <div className="max-w-2xl mx-auto lg:mx-0">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
              </button>
            </div>
          </div>
            </div>
          </div>
          </div>
        </div>
      </div>
```

–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ç–µ–≥–æ–≤:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-5 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-4 order-1 lg:order-2">
            <div className="max-w-2xl mx-auto lg:mx-0">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ò—Å–ø—Ä–∞–≤–∏–ª —Ä–∞–∑–º–µ—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–£–º–µ–Ω—å—à–µ–Ω –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**: `max-w-7xl` ‚Üí `max-w-6xl`
2. **–ò–∑–º–µ–Ω–µ–Ω–∞ —Å–µ—Ç–∫–∞**: —Å 4 –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ 5 –∫–æ–ª–æ–Ω–æ–∫
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: 1 –∫–æ–ª–æ–Ω–∫–∞
   - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: 4 –∫–æ–ª–æ–Ω–∫–∏
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞**: –¥–æ–±–∞–≤–ª–µ–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `max-w-2xl` –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, —á—Ç–æ–±—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –æ–Ω –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª—Å—è

–†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–∞–ª –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ, –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –∏ –ª—É—á—à–µ —Å–º–æ—Ç—Ä–∏—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ. –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.

---

**User**

—Ö–æ—Ä–æ—à–∏–π —Ä–∞–∑–º–µ—Ä. –Ω–æ —Å–±–∏–ª–∞—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, —á—Ç–æ —Å–ª–µ–≤–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∞ —Å–ø—Ä–∞–≤–∞ - –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä. –Ω–∞–¥–æ —ç—Ç–æ –≤–µ—Ä–Ω—É—Ç—å.

---

**Cursor**


–ü—Ä–æ–≤–µ—Ä—è—é –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Å–µ—Ç–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞.


–ò—Å–ø—Ä–∞–≤–ª—è—é –ø–æ—Ä—è–¥–æ–∫: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö; –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–≤–µ—Ä—Ö—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–Ω–∏–∑—É.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-5 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-4 order-1 lg:order-1">
            <div className="max-w-2xl lg:ml-auto">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–í–æ–∑–≤—Ä–∞—â–∞—é –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-5 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="lg:col-span-1 order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-4 order-1 lg:order-2">
            <div className="max-w-2xl lg:ml-auto">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ü–æ—Ä—è–¥–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

**–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**

1. –ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `order-2 lg:order-1` ‚Äî —Å–ª–µ–≤–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ
   - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: `order-1 lg:order-2` ‚Äî —Å–ø—Ä–∞–≤–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ

2. –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞: `lg:ml-auto` ‚Äî –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –ø—Ä–∏–∂–∏–º–∞–µ—Ç—Å—è –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é, —Å–æ—Ö—Ä–∞–Ω—è—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `max-w-2xl`.

–¢–µ–ø–µ—Ä—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞. –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö: –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–≤–µ—Ä—Ö—É, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–Ω–∏–∑—É.

---

**User**

–ø–æ—Å–º–æ—Ç—Ä–∏, –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∏ –∑–∞–Ω–∏–º–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ø—Ä–∏–º–µ—Ä–Ω–æ —à–∏—Ä–∏–Ω—É: –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∏ —Ç–µ–∫—Å—Ç. 

---

**Cursor**


–í—ã—Ä–∞–≤–Ω–∏–≤–∞—é —à–∏—Ä–∏–Ω—É: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–∏–º–µ—Ä–Ω–æ –ø–æ—Ä–æ–≤–Ω—É.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="lg:col-span-4 order-1 lg:order-2">
            <div className="max-w-2xl lg:ml-auto">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–ü—Ä–æ–≤–µ—Ä—è—é, –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ª–∏ –ª–∏—à–Ω–∏—Ö –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ç–µ–≥–æ–≤:


–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫—Ä—ã–≤–∞—é—â–∏—Ö —Ç–µ–≥–æ–≤:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–û–±–Ω–æ–≤–ª–µ–Ω–æ: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–Ω–∏–º–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —à–∏—Ä–∏–Ω—É.

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**

1. **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è —Å–µ—Ç–∫–∞**: –° `lg:grid-cols-5` –Ω–∞ `lg:grid-cols-2` ‚Äî —Ç–µ–ø–µ—Ä—å –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–æ 50% –∫–∞–∂–¥–∞—è
2. **–£–±—Ä–∞–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –£–¥–∞–ª–µ–Ω—ã `lg:col-span-1` –∏ `lg:col-span-4`, —Ç–µ–ø–µ—Ä—å –∫–æ–ª–æ–Ω–∫–∏ —Ä–∞–≤–Ω—ã
3. **–£–±—Ä–∞–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã**: –£–¥–∞–ª–µ–Ω `max-w-2xl` –∏ `lg:ml-auto` —É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Ç–µ–ø–µ—Ä—å –∑–∞–Ω–∏–º–∞–µ—Ç —Ä–æ–≤–Ω–æ –ø–æ–ª–æ–≤–∏–Ω—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

–¢–µ–ø–µ—Ä—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö:
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞: **50% —à–∏—Ä–∏–Ω—ã**
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞: **50% —à–∏—Ä–∏–Ω—ã**

–°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.

---

**User**

—Å—É–ø–µ—Ä! –Ω–µ–±–æ–ª—å—à–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É: –¥–∞–≤–∞–π –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–≤–µ–¥–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∞–ª –≤—Ä—É—á–Ω—É—é –≤–≤–æ–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –æ–±—â–µ–π –¥–ª–∏–Ω–µ —Å—Ç–µ–Ω. –∞ –µ—Å–ª–∏ –æ–Ω –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–ª –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É, –æ–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω –ø–æ—è–≤–∏–ª–∞—Å—å, –Ω–æ –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –Ω–µ –Ω—É–∂–Ω–æ —Å—Ä–∞–∑—É –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–≤–æ–¥/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã —Å—Ç–µ–Ω. —Ç–∞–∫ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ.

---

**Cursor**


–î–æ–±–∞–≤–ª—è—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞: –±–ª–æ–∫–∏—Ä—É–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é.


–î–æ–±–∞–≤–ª—è—é –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω –≤—Ä—É—á–Ω—É—é (–∫–æ–≥–¥–∞ –¥–ª–∏–Ω–∞ –∏ —à–∏—Ä–∏–Ω–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã)
    const perimeterFilledManually = formData.perimeter && !formData.houseLength && !formData.houseWidth;
    if (perimeterFilledManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
    } else if (!length && !width && !formData.perimeter) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ –∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ç–æ–∂–µ –ø—É—Å—Ç–æ–π, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      return;
    }
  }, [formData.houseLength, formData.houseWidth, formData.perimeter]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (perimeterEnteredManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—è
      setPerimeterEnteredManually(false);
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
      if (!perimeterEnteredManually) {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
  }, [formData.houseLength, formData.houseWidth, perimeterEnteredManually]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (perimeterEnteredManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—è
      setPerimeterEnteredManually(false);
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
      if (!perimeterEnteredManually) {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
  }, [formData.houseLength, formData.houseWidth, perimeterEnteredManually]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      // –ü–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
      setPerimeterEnteredManually(true);
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else if (field === 'houseLength' || field === 'houseWidth') {
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã –∏–ª–∏ —à–∏—Ä–∏–Ω—ã —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
      // –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      setFormData((prev) => ({ ...prev, [field]: value }));
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –µ—Å–ª–∏ –º—ã –æ—á–∏—â–∞–µ–º –ø–æ–ª—è
      if (!value || (!formData.houseLength && !formData.houseWidth)) {
        setPerimeterEnteredManually(false);
      }
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã
  const isLengthWidthDisabled = !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (perimeterEnteredManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—è
      setPerimeterEnteredManually(false);
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
      if (!perimeterEnteredManually) {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
  }, [formData.houseLength, formData.houseWidth, perimeterEnteredManually]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      // –ü–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
      setPerimeterEnteredManually(true);
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else if (field === 'houseLength' || field === 'houseWidth') {
      // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã –∏–ª–∏ —à–∏—Ä–∏–Ω—ã —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
      // –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
      setFormData((prev) => ({ ...prev, [field]: value }));
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –µ—Å–ª–∏ –º—ã –æ—á–∏—â–∞–µ–º –ø–æ–ª—è
      if (!value || (!formData.houseLength && !formData.houseWidth)) {
        setPerimeterEnteredManually(false);
      }
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é)
  const isLengthWidthDisabled = perimeterEnteredManually && !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–£–ª—É—á—à–∞—é –ª–æ–≥–∏–∫—É —Å–±—Ä–æ—Å–∞ —Ñ–ª–∞–≥–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã –∏–ª–∏ —à–∏—Ä–∏–Ω—ã:


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function CalculatorPage() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (perimeterEnteredManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—è
      setPerimeterEnteredManually(false);
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
      if (!perimeterEnteredManually) {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
  }, [formData.houseLength, formData.houseWidth, perimeterEnteredManually]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      // –ü–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
      setPerimeterEnteredManually(true);
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else if (field === 'houseLength' || field === 'houseWidth') {
      setFormData((prev) => ({ ...prev, [field]: value }));
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –¥–ª–∏–Ω—É/—à–∏—Ä–∏–Ω—É, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
      // —á—Ç–æ–±—ã –ø–µ—Ä–∏–º–µ—Ç—Ä –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –ø–æ–ª—è –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å
      setPerimeterEnteredManually(false);
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é)
  const isLengthWidthDisabled = perimeterEnteredManually && !!formData.perimeter;

  return (
    <main className="bg-gray-50 min-h-screen">
      {/* Breadcrumbs */}
      <div className="bg-white border-b">
        <div className="container mx-auto px-4 py-3">
          <div className="flex items-center space-x-2 text-sm text-gray-600">
            <Link href="/" className="hover:text-orange-600">
              –ì–ª–∞–≤–Ω–∞—è
            </Link>
            <span>/</span>
            <span className="text-gray-900">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
            {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
              <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
              <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseLength}
                    onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.houseWidth}
                    onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                    onBlur={calculatePerimeter}
                    disabled={isLengthWidthDisabled}
                    min="1"
                    max="50"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                  />
                </div>
              </div>

              <div className="mb-6">
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                </label>
                <input
                  type="number"
                  value={formData.perimeter}
                  onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                  min="1"
                  max="200"
                  step="0.5"
                  className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                />
                <small className="text-xs text-gray-500 mt-1 block">
                  –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                </small>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                  </label>
                  <input
                    type="number"
                    value={formData.wallHeight}
                    onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                    min="2"
                    max="15"
                    step="0.1"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                  </label>
                  <select
                    value={formData.blockThickness}
                    onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  >
                    <option value="200">200 –º–º</option>
                    <option value="250">250 –º–º</option>
                    <option value="300">300 –º–º</option>
                    <option value="375">375 –º–º</option>
                    <option value="400">400 –º–º</option>
                  </select>
                </div>
              </div>

              {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
              <div className="mb-6 text-center">
                <button
                  type="button"
                  onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                  className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                >
                  <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                  –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                </button>

                {isAdvancedOpen && (
                  <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                    {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.windowsCount}
                            onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                            min="0"
                            max="50"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowHeight}
                            onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.windowWidth}
                            onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                            min="0.5"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.doorsCount}
                            onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                            min="0"
                            max="20"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorHeight}
                            onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                            min="1"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.doorWidth}
                            onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                            min="0.5"
                            max="3"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                          <input
                            type="number"
                            value={formData.gableCount}
                            onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                            min="0"
                            max="10"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.gableHeight}
                            onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                            min="0.5"
                            max="10"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                          <input
                            type="number"
                            value={formData.gableWidth}
                            onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                            min="1"
                            max="50"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                      </div>
                    </div>

                    {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                    <div>
                      <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsLength}
                            onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                            min="0"
                            max="200"
                            step="0.5"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                          <input
                            type="number"
                            value={formData.partitionsHeight}
                            onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                            min="1"
                            max="5"
                            step="0.1"
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          />
                        </div>
                        <div>
                          <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                          <select
                            value={formData.partitionsThickness}
                            onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                            className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                          >
                            <option value="100">100 –º–º</option>
                            <option value="150">150 –º–º</option>
                            <option value="200">200 –º–º</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>

              {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                <div className="space-y-4">
                  <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                    <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                    <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                    <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                  </div>
                </div>
                <div
                  onClick={openModal}
                  className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                >
                  <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                </div>
              </div>

              <p className="text-center text-sm text-gray-600 mb-6">
                –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
              </p>

              <button
                onClick={openModal}
                className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
              >
                üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
              </button>
            </div>
          </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}

    </main>
  );
}

```

–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞.

**–ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ:**

1. –î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ `perimeterEnteredManually` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞.

2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π:
   - –ü–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é (`perimeterEnteredManually && !!formData.perimeter`).
   - –ï—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –ø–æ–ª—è –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.

3. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
   - –í–≤–æ–¥ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –≤—Ä—É—á–Ω—É—é ‚Üí —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ ‚Üí –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.
   - –í–≤–æ–¥ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã ‚Üí –ø–µ—Ä–∏–º–µ—Ç—Ä —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Üí —Ñ–ª–∞–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è ‚Üí –ø–æ–ª—è –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã ‚Üí —Ñ–ª–∞–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è ‚Üí –ø–µ—Ä–∏–º–µ—Ç—Ä –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ‚Üí –ø–æ–ª—è –æ—Å—Ç–∞—é—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏.

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É, –∞ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞.

–°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ.

---

**User**

–æ—Ç–ª–∏—á–Ω–æ. –µ—Å–ª–∏ –Ω—É–∂–Ω–æ, –¥–æ–±–∞–≤—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª—ã —Ä–∏–¥–º–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å. –∏ —è –±—É–¥—É –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ

---

**Cursor**


–û–±–Ω–æ–≤–ª—è—é README-RU.md –∏ PROGRESS.md —Å —Ç–µ–∫—É—â–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:


–û–±–Ω–æ–≤–ª—è—é PROGRESS.md –∏ README-RU.md —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ:


```markdown
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 16.0.1

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js 16.0.1 —Å TypeScript
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω PostCSS –∏ Autoprefixer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω ESLint –¥–ª—è Next.js 16
- ‚úÖ –°–æ–∑–¥–∞–Ω `.gitignore`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Header** ‚Äî —à–∞–ø–∫–∞ —Å–∞–π—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é
- ‚úÖ **Footer** ‚Äî –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª–µ–∑–Ω–æ–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)

### Layout
- ‚úÖ `app/layout.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π layout —Å Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è SEO
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω —à—Ä–∏—Ñ—Ç Inter —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### Dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞
   - ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - [ ] `app/delivery/page.tsx` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - [ ] `app/contacts/page.tsx` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - [ ] Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
   - [ ] –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
   - [ ] –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
   - [ ] FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
   - [ ] –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏–¥–æ–≤:**
   - [ ] `app/api/send-lead/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot
   - [ ] `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: SEO –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
5. **SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
   - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Schema.org)
   - [ ] Sitemap.xml
   - [ ] Robots.txt

6. **–ö–æ–Ω—Ç–µ–Ω—Ç:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ email
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---

## üìã –ó–∞–º–µ—Ç–∫–∏ –∏ –∏–¥–µ–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Next.js 16.0.1 (–≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ—Å—è 16.x –∏–∑-–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- React 19
- Tailwind CSS 3.4.18
- TypeScript 5

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- App Router (Next.js 13+)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `components/`
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C

### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã
1. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ü–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ API ‚Äî —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**31.10.2025**
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç —Å Next.js 14 –Ω–∞ Next.js 16.0.1
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (PROGRESS.md)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã" –≤ Header
- ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: Catalog, Calculator, FAQ


```

```markdown
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 16.0.1

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js 16.0.1 —Å TypeScript
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω PostCSS –∏ Autoprefixer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω ESLint –¥–ª—è Next.js 16
- ‚úÖ –°–æ–∑–¥–∞–Ω `.gitignore`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Header** ‚Äî —à–∞–ø–∫–∞ —Å–∞–π—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é
- ‚úÖ **Footer** ‚Äî –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª–µ–∑–Ω–æ–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)

### Layout
- ‚úÖ `app/layout.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π layout —Å Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è SEO
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω —à—Ä–∏—Ñ—Ç Inter —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (50/50 –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ (–æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ Debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage –∏ fetch

### Dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞
   - ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - [ ] `app/delivery/page.tsx` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - [ ] `app/contacts/page.tsx` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - [ ] Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
   - [ ] –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
   - [ ] –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
   - [ ] FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
   - [ ] –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏–¥–æ–≤:**
   - [ ] `app/api/send-lead/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot
   - [ ] `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: SEO –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
5. **SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
   - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Schema.org)
   - [ ] Sitemap.xml
   - [ ] Robots.txt

6. **–ö–æ–Ω—Ç–µ–Ω—Ç:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ email
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---

## üìã –ó–∞–º–µ—Ç–∫–∏ –∏ –∏–¥–µ–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Next.js 16.0.1 (–≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ—Å—è 16.x –∏–∑-–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- React 19
- Tailwind CSS 3.4.18
- TypeScript 5

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- App Router (Next.js 13+)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `components/`
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C

### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã
1. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ü–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ API ‚Äî —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**31.10.2025**
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç —Å Next.js 14 –Ω–∞ Next.js 16.0.1
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (PROGRESS.md)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã" –≤ Header
- ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: Catalog, Calculator, FAQ


```

```markdown
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 16.0.1

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js 16.0.1 —Å TypeScript
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω PostCSS –∏ Autoprefixer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω ESLint –¥–ª—è Next.js 16
- ‚úÖ –°–æ–∑–¥–∞–Ω `.gitignore`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Header** ‚Äî —à–∞–ø–∫–∞ —Å–∞–π—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é
- ‚úÖ **Footer** ‚Äî –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª–µ–∑–Ω–æ–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)

### Layout
- ‚úÖ `app/layout.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π layout —Å Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è SEO
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω —à—Ä–∏—Ñ—Ç Inter —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (50/50 –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ (–æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ Debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage –∏ fetch

### Dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞
   - ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - [ ] `app/delivery/page.tsx` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - [ ] `app/contacts/page.tsx` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - [ ] Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
   - [ ] –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
   - [ ] –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
   - [ ] FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
   - [ ] –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏–¥–æ–≤:**
   - [ ] `app/api/send-lead/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot
   - [ ] `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: SEO –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
5. **SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
   - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Schema.org)
   - [ ] Sitemap.xml
   - [ ] Robots.txt

6. **–ö–æ–Ω—Ç–µ–Ω—Ç:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ email
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---

## üìã –ó–∞–º–µ—Ç–∫–∏ –∏ –∏–¥–µ–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Next.js 16.0.1 (–≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ—Å—è 16.x –∏–∑-–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- React 19
- Tailwind CSS 3.4.18
- TypeScript 5

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- App Router (Next.js 13+)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `components/`
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C

### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã
1. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ü–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ API ‚Äî —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–µ–∫–∞–±—Ä—å 2025**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ –Ω–∞ React + TypeScript
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ 50/50)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ UX: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –¥–ª—è –±–æ–ª–µ–µ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –≤–∏–¥–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª CALCULATOR_TODO.md —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏

**31.10.2025**
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç —Å Next.js 14 –Ω–∞ Next.js 16.0.1
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (PROGRESS.md)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã" –≤ Header
- ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: Catalog, Calculator, FAQ


```

```markdown
# –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online - –ö–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤

SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∞–π—Ç-–∫–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –Ω–∞ Next.js 16.

> **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞:** –≠—Ç–æ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –ª–∏–¥–≥–µ–Ω–∞ –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –ª–∏–¥–æ–≤. –ì–∞–∑–æ–±–µ—Ç–æ–Ω ‚Äî –ø–µ—Ä–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫—Ä–æ–≤–ª—è, –∫–∏—Ä–ø–∏—á, —Ñ–∞—Å–∞–¥—ã –∏ —Ç.–¥.) —Å –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–µ–π –ª–∏–¥–æ–≤ —á–µ—Ä–µ–∑ –∫–≤–∏–∑—ã.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
npm install
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: **http://localhost:3000**

### –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
npm run build
npm start
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gazobeton-online/
‚îú‚îÄ‚îÄ app/                      # –°—Ç—Ä–∞–Ω–∏—Ü—ã Next.js (App Router)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx           # –ì–ª–∞–≤–Ω—ã–π layout —Å Header –∏ Footer
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ catalog/             # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ calculator/          # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ä–∞—Å—á–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ faq/                 # –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ FAQ
‚îÇ   ‚îú‚îÄ‚îÄ delivery/            # –î–æ—Å—Ç–∞–≤–∫–∞ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
‚îÇ   ‚îî‚îÄ‚îÄ contacts/            # –ö–æ–Ω—Ç–∞–∫—Ç—ã (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ components/              # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx          # –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ (—Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx          # –ü–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ Header.old.tsx     # –°—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç Header (–∞—Ä—Ö–∏–≤)
‚îú‚îÄ‚îÄ public/                 # –°—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏–∫–æ–Ω–∫–∏)
‚îî‚îÄ‚îÄ PROGRESS.md             # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

---

## ‚ú® –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ Layout —Å Header –∏ Footer (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ)
- ‚úÖ Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º, –∏–∫–æ–Ω–∫–∞ –±–ª–æ–∫–∞
- ‚úÖ Footer: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –≤ Header: "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã"

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ (6 –ø—Ä–∏–º–µ—Ä–æ–≤)
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ React + TypeScript)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, 16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ –ú–µ—Ç–∞-—Ç–µ–≥–∏ (title, description)
- ‚úÖ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ (lang="ru")
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ (H1, H2, etc.)
- ‚úÖ –®—Ä–∏—Ñ—Ç —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π (Inter)

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –ü–ª–∞–Ω—à–µ—Ç
- ‚úÖ Desktop

## ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`)
- ‚ùå Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
- ‚ùå –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
- ‚ùå –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
- ‚ùå –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- ‚ùå FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
- ‚ùå –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚ùå `/delivery` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
- ‚ùå `/contacts` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚ùå `app/api/send-lead/route.ts` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤ –≤ Telegram Bot
- ‚ùå `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ª–∏–¥–≥–µ–Ω–∞
–ü—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–∏–¥–æ–≤ –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –ª–∏–¥–æ–≤ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. **–°–∞–π—Ç-–∫–∞—Ç–∞–ª–æ–≥** (—Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç) ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ —Å FAQ –ø–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤—É
2. **–°–∞–π—Ç "–ø–æ-–¥–µ—à–µ–≤–ª–µ.—Ä—Ñ"** ‚Äî –ª–µ–Ω–¥–∏–Ω–≥ —Å –∫–≤–∏–∑–æ–º –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–∞–º–æ–≥–æ –≤—ã–≥–æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–ú—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–∏ –ª–∏–¥–æ–≤:**
- –ö–ª–∏–µ–Ω—Ç –Ω–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω ‚Üí –ø—Ä–æ–¥–∞–∂–∞ –ª–∏–¥–∞ –Ω–∞ –∫—Ä–æ–≤–ª—é ‚Üí —Ñ–∞—Å–∞–¥ ‚Üí –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- –ö–≤–∏–∑—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–¥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –±—É–¥—É—â–∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö
- –î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫—Ä–æ—Å—Å-–ø—Ä–æ–¥–∞–∂ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ö

### SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞
- –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–±–µ–∑ "–≤–æ–¥—ã" –∏ –±–æ–ª—å—à–∏—Ö –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤)
- –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤—ã—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è LLM-–º–æ–¥–µ–ª–µ–π (AI-SEO)

### –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –ü–æ–¥–¥–æ–º–µ–Ω—ã –Ω–∞ –æ–±–ª–∞—Å—Ç–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã (moscow, spb, ufa, izhevsk, samara)
- –í –¥–∞–ª—å–Ω–µ–π—à–µ–º ‚Äî –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–µ–Ω—å—à–∏–µ –≥–æ—Ä–æ–¥–∞
- –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —Ü–µ–Ω

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **Next.js 16.0.1** ‚Äî –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª—Å—è Next.js 16, –Ω–æ –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è 16.0.1
- **React 19** ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- **TypeScript 5** ‚Äî —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
- **Tailwind CSS 3.4.18** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
**–û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞:**
- **–û—Ä–∞–Ω–∂–µ–≤—ã–π** (`orange-600`: #EA580C) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è CTA, –∫–Ω–æ–ø–æ–∫, hover-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π** (`navy-950`, `navy-900`) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç Header, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞
- **–ë–µ–ª—ã–π/–°–µ—Ä—ã–π** ‚Äî —Ñ–æ–Ω –∏ —Ç–µ–∫—Å—Ç

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
- –ö–Ω–æ–ø–∫–∏ CTA: –æ—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
- –ê–∫—Ü–µ–Ω—Ç—ã: –æ—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è hover –∏ —Å—Å—ã–ª–æ–∫
- –¢–µ–∫—Å—Ç: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π/—Å–µ—Ä—ã–π –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ, –±–µ–ª—ã–π –Ω–∞ —Ç–µ–º–Ω–æ–º

### –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
–ò–∑—É—á–µ–Ω—ã —Ç–æ–ø–æ–≤—ã–µ —Å–∞–π—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º "–∫—É–ø–∏—Ç—å –≥–∞–∑–æ–±–µ—Ç–æ–Ω":

**–ú–æ—Å–∫–≤–∞:**
- https://stroykaskad.ru/category/penobloki/gazobetonnye-bloki/
- https://stenovoy.ru/catalog/bloki/gazobeton/

**–°–ü–±:**
- https://gazosilikatstroy.ru/catalog/
- https://tskarteco.ru/catalog/stroitelnyie-bloki/gazobeton/

–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —Ç–æ–ø–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–Ω–∏–º–∞—é—Ç –∏–º–µ–Ω–Ω–æ —Å–∞–π—Ç—ã-–∫–∞—Ç–∞–ª–æ–≥–∏, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ –≤—ã–±–æ—Ä –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

---

## üìù –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm run dev` | –ó–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞ (http://localhost:3000) |
| `npm run build` | –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ |
| `npm start` | –ó–∞–ø—É—Å–∫ production-–≤–µ—Ä—Å–∏–∏ |
| `npm run lint` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º |

---

## üåç –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω—ã:**
- –ú–æ—Å–∫–≤–∞: `moscow.gazobeton-online.ru`
- –°–ü–±: `spb.gazobeton-online.ru`
- –£—Ñ–∞: `ufa.gazobeton-online.ru`
- –ò–∂–µ–≤—Å–∫: `izhevsk.gazobeton-online.ru`
- –°–∞–º–∞—Ä–∞: `samara.gazobeton-online.ru`

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–∞–ø–∫–∏ (`/moscow/`, `/spb/`)

**–≠—Ç–∞–ø–Ω–æ—Å—Ç—å:**
1. –ù–∞—á–∞—Ç—å —Å –æ–±–ª–∞—Å—Ç–Ω—ã—Ö —Ü–µ–Ω—Ç—Ä–æ–≤
2. –ó–∞—Ç–µ–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –º–µ–Ω—å—à–∏–µ –≥–æ—Ä–æ–¥–∞
3. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

---

## üìã –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏
1. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∫–≤–∏–∑–æ–º, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º–∏, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏, FAQ
2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç–∞–≤–∫–∏** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –æ–ø–ª–∞—Ç–µ
3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤** ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
4. **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Äî Telegram Bot –∏ amoCRM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏–¥–æ–≤

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã
2. –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è SEO (—Å—Ç–∞—Ç—å–∏, –≥–∞–π–¥—ã)
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–≤–∏–∑–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞–¥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. –°–∞–π—Ç "–ø–æ-–¥–µ—à–µ–≤–ª–µ.—Ä—Ñ" ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–µ–Ω–¥–∏–Ω–≥ —Å –∫–≤–∏–∑–æ–º
2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫—Ä–æ–≤–ª—è, –∫–∏—Ä–ø–∏—á, —Ñ–∞—Å–∞–¥—ã)
3. –°–∏—Å—Ç–µ–º–∞ –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂ –ª–∏–¥–æ–≤

---

## üé® –î–∏–∑–∞–π–Ω

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:**
- –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç: –û—Ä–∞–Ω–∂–µ–≤—ã–π (#EA580C, orange-600)
- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω Header: –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π (#0f172a, navy-950)
- –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü: –ë–µ–ª—ã–π, —Å–µ—Ä—ã–π-50
- –¢–µ–∫—Å—Ç: –°–µ—Ä—ã–π-900, –°–µ—Ä—ã–π-600, –±–µ–ª—ã–π –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ

**–®—Ä–∏—Ñ—Ç—ã:**
- Inter (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Ñ–æ–Ω—ã –¥–ª—è Header –∏ –∫–Ω–æ–ø–æ–∫
- –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (rounded-lg, rounded-xl)
- –¢–µ–Ω–∏ –¥–ª—è –≥–ª—É–±–∏–Ω—ã (shadow-sm, shadow-md, shadow-lg)
- –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (transition)

---

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–º. –≤ —Ñ–∞–π–ª–µ **[PROGRESS.md](./PROGRESS.md)**

---

## üìû –í–æ–ø—Ä–æ—Å—ã?

–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤ —á–∞—Ç–µ ‚Äî —è –ø–æ–º–æ–≥—É!


```

```markdown
# –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online - –ö–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤

SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∞–π—Ç-–∫–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –Ω–∞ Next.js 16.

> **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞:** –≠—Ç–æ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –ª–∏–¥–≥–µ–Ω–∞ –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –ª–∏–¥–æ–≤. –ì–∞–∑–æ–±–µ—Ç–æ–Ω ‚Äî –ø–µ—Ä–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫—Ä–æ–≤–ª—è, –∫–∏—Ä–ø–∏—á, —Ñ–∞—Å–∞–¥—ã –∏ —Ç.–¥.) —Å –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–µ–π –ª–∏–¥–æ–≤ —á–µ—Ä–µ–∑ –∫–≤–∏–∑—ã.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
npm install
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: **http://localhost:3000**

### –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
npm run build
npm start
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
gazobeton-online/
‚îú‚îÄ‚îÄ app/                      # –°—Ç—Ä–∞–Ω–∏—Ü—ã Next.js (App Router)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx           # –ì–ª–∞–≤–Ω—ã–π layout —Å Header –∏ Footer
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ catalog/             # –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ calculator/          # –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Ä–∞—Å—á–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ faq/                 # –í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # –°—Ç—Ä–∞–Ω–∏—Ü–∞ FAQ
‚îÇ   ‚îú‚îÄ‚îÄ delivery/            # –î–æ—Å—Ç–∞–≤–∫–∞ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
‚îÇ   ‚îî‚îÄ‚îÄ contacts/            # –ö–æ–Ω—Ç–∞–∫—Ç—ã (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
‚îú‚îÄ‚îÄ components/              # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx          # –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ (—Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx          # –ü–æ–¥–≤–∞–ª —Å–∞–π—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ Header.old.tsx     # –°—Ç–∞—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç Header (–∞—Ä—Ö–∏–≤)
‚îú‚îÄ‚îÄ public/                 # –°—Ç–∞—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∏–∫–æ–Ω–∫–∏)
‚îî‚îÄ‚îÄ PROGRESS.md             # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

---

## ‚ú® –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ Layout —Å Header –∏ Footer (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ)
- ‚úÖ Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º, –∏–∫–æ–Ω–∫–∞ –±–ª–æ–∫–∞
- ‚úÖ Footer: –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏
- ‚úÖ –ü–æ–¥–ø–∏—Å—å –≤ Header: "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã"

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤ (6 –ø—Ä–∏–º–µ—Ä–æ–≤)
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ React + TypeScript)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, 16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- ‚úÖ –ú–µ—Ç–∞-—Ç–µ–≥–∏ (title, description)
- ‚úÖ –†—É—Å—Å–∫–∏–π —è–∑—ã–∫ (lang="ru")
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ (H1, H2, etc.)
- ‚úÖ –®—Ä–∏—Ñ—Ç —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π (Inter)

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
- ‚úÖ –ü–ª–∞–Ω—à–µ—Ç
- ‚úÖ Desktop

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª–∏)
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- ‚úÖ –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞)
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
- ‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å 3 —à–∞–≥–∞–º–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Apps Script –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏–¥–æ–≤
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ lead scoring –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏–¥–∞
- ‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce

## ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`)
- ‚ùå Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
- ‚ùå –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
- ‚ùå –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
- ‚ùå –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- ‚ùå FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
- ‚ùå –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚ùå `/delivery` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
- ‚ùå `/contacts` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚ùå `app/api/send-lead/route.ts` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏–¥–æ–≤ –≤ Telegram Bot
- ‚ùå `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ª–∏–¥–≥–µ–Ω–∞
–ü—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–∏–¥–æ–≤ –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–º –±–∏–∑–Ω–µ—Å–µ. –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ç–∏ SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ –¥–ª—è –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –ª–∏–¥–æ–≤ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. **–°–∞–π—Ç-–∫–∞—Ç–∞–ª–æ–≥** (—Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç) ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ —Å FAQ –ø–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤—É
2. **–°–∞–π—Ç "–ø–æ-–¥–µ—à–µ–≤–ª–µ.—Ä—Ñ"** ‚Äî –ª–µ–Ω–¥–∏–Ω–≥ —Å –∫–≤–∏–∑–æ–º –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —Å–∞–º–æ–≥–æ –≤—ã–≥–æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–ú—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂–∏ –ª–∏–¥–æ–≤:**
- –ö–ª–∏–µ–Ω—Ç –Ω–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω ‚Üí –ø—Ä–æ–¥–∞–∂–∞ –ª–∏–¥–∞ –Ω–∞ –∫—Ä–æ–≤–ª—é ‚Üí —Ñ–∞—Å–∞–¥ ‚Üí –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- –ö–≤–∏–∑—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–±–∏—Ä–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç–∞–¥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –±—É–¥—É—â–∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö
- –î–∞–Ω–Ω—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫—Ä–æ—Å—Å-–ø—Ä–æ–¥–∞–∂ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ö

### SEO-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞
- –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–±–µ–∑ "–≤–æ–¥—ã" –∏ –±–æ–ª—å—à–∏—Ö –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤)
- –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤—ã—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è LLM-–º–æ–¥–µ–ª–µ–π (AI-SEO)

### –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- –ü–æ–¥–¥–æ–º–µ–Ω—ã –Ω–∞ –æ–±–ª–∞—Å—Ç–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã (moscow, spb, ufa, izhevsk, samara)
- –í –¥–∞–ª—å–Ω–µ–π—à–µ–º ‚Äî –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–µ–Ω—å—à–∏–µ –≥–æ—Ä–æ–¥–∞
- –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —Ü–µ–Ω

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **Next.js 16.0.1** ‚Äî –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª—Å—è Next.js 16, –Ω–æ –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å–±–æ–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è 16.0.1
- **React 19** ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
- **TypeScript 5** ‚Äî —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞
- **Tailwind CSS 3.4.18** ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
**–û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞:**
- **–û—Ä–∞–Ω–∂–µ–≤—ã–π** (`orange-600`: #EA580C) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è CTA, –∫–Ω–æ–ø–æ–∫, hover-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π** (`navy-950`, `navy-900`) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç Header, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞
- **–ë–µ–ª—ã–π/–°–µ—Ä—ã–π** ‚Äî —Ñ–æ–Ω –∏ —Ç–µ–∫—Å—Ç

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
- –ö–Ω–æ–ø–∫–∏ CTA: –æ—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
- –ê–∫—Ü–µ–Ω—Ç—ã: –æ—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è hover –∏ —Å—Å—ã–ª–æ–∫
- –¢–µ–∫—Å—Ç: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π/—Å–µ—Ä—ã–π –Ω–∞ —Å–≤–µ—Ç–ª–æ–º —Ñ–æ–Ω–µ, –±–µ–ª—ã–π –Ω–∞ —Ç–µ–º–Ω–æ–º

### –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑
–ò–∑—É—á–µ–Ω—ã —Ç–æ–ø–æ–≤—ã–µ —Å–∞–π—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º "–∫—É–ø–∏—Ç—å –≥–∞–∑–æ–±–µ—Ç–æ–Ω":

**–ú–æ—Å–∫–≤–∞:**
- https://stroykaskad.ru/category/penobloki/gazobetonnye-bloki/
- https://stenovoy.ru/catalog/bloki/gazobeton/

**–°–ü–±:**
- https://gazosilikatstroy.ru/catalog/
- https://tskarteco.ru/catalog/stroitelnyie-bloki/gazobeton/

–ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª, —á—Ç–æ —Ç–æ–ø–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–Ω–∏–º–∞—é—Ç –∏–º–µ–Ω–Ω–æ —Å–∞–π—Ç—ã-–∫–∞—Ç–∞–ª–æ–≥–∏, —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ –≤—ã–±–æ—Ä –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏.

---

## üìù –ö–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `npm run dev` | –ó–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞ (http://localhost:3000) |
| `npm run build` | –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ |
| `npm start` | –ó–∞–ø—É—Å–∫ production-–≤–µ—Ä—Å–∏–∏ |
| `npm run lint` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º |

---

## üåç –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏

**–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω—ã:**
- –ú–æ—Å–∫–≤–∞: `moscow.gazobeton-online.ru`
- –°–ü–±: `spb.gazobeton-online.ru`
- –£—Ñ–∞: `ufa.gazobeton-online.ru`
- –ò–∂–µ–≤—Å–∫: `izhevsk.gazobeton-online.ru`
- –°–∞–º–∞—Ä–∞: `samara.gazobeton-online.ru`

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–∞–ø–∫–∏ (`/moscow/`, `/spb/`)

**–≠—Ç–∞–ø–Ω–æ—Å—Ç—å:**
1. –ù–∞—á–∞—Ç—å —Å –æ–±–ª–∞—Å—Ç–Ω—ã—Ö —Ü–µ–Ω—Ç—Ä–æ–≤
2. –ó–∞—Ç–µ–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –º–µ–Ω—å—à–∏–µ –≥–æ—Ä–æ–¥–∞
3. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

---

## üìã –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏
1. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∫–≤–∏–∑–æ–º, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è–º–∏, –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏, FAQ
2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç–∞–≤–∫–∏** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –æ–ø–ª–∞—Ç–µ
3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤** ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
4. **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Äî Telegram Bot –∏ amoCRM –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–∏–¥–æ–≤

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã
2. –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è SEO (—Å—Ç–∞—Ç—å–∏, –≥–∞–π–¥—ã)
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–≤–∏–∑–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞–¥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. –°–∞–π—Ç "–ø–æ-–¥–µ—à–µ–≤–ª–µ.—Ä—Ñ" ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–µ–Ω–¥–∏–Ω–≥ —Å –∫–≤–∏–∑–æ–º
2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫—Ä–æ–≤–ª—è, –∫–∏—Ä–ø–∏—á, —Ñ–∞—Å–∞–¥—ã)
3. –°–∏—Å—Ç–µ–º–∞ –º—É–ª—å—Ç–∏-–ø—Ä–æ–¥–∞–∂ –ª–∏–¥–æ–≤

---

## üé® –î–∏–∑–∞–π–Ω

**–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞:**
- –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç: –û—Ä–∞–Ω–∂–µ–≤—ã–π (#EA580C, orange-600)
- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω Header: –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π (#0f172a, navy-950)
- –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü: –ë–µ–ª—ã–π, —Å–µ—Ä—ã–π-50
- –¢–µ–∫—Å—Ç: –°–µ—Ä—ã–π-900, –°–µ—Ä—ã–π-600, –±–µ–ª—ã–π –Ω–∞ —Ç–µ–º–Ω–æ–º —Ñ–æ–Ω–µ

**–®—Ä–∏—Ñ—Ç—ã:**
- Inter (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Ñ–æ–Ω—ã –¥–ª—è Header –∏ –∫–Ω–æ–ø–æ–∫
- –°–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã (rounded-lg, rounded-xl)
- –¢–µ–Ω–∏ –¥–ª—è –≥–ª—É–±–∏–Ω—ã (shadow-sm, shadow-md, shadow-lg)
- –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã (transition)

---

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

–ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–º. –≤ —Ñ–∞–π–ª–µ **[PROGRESS.md](./PROGRESS.md)**

---

## üìû –í–æ–ø—Ä–æ—Å—ã?

–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤ —á–∞—Ç–µ ‚Äî —è –ø–æ–º–æ–≥—É!


```

–û–±–Ω–æ–≤–∏–ª —Ñ–∞–π–ª—ã PROGRESS.md –∏ README-RU.md —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ.

## –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ PROGRESS.md:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª—å–Ω–æ)" —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–î–µ–∫–∞–±—Ä—å 2025) —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## –û–±–Ω–æ–≤–ª–µ–Ω–æ –≤ README-RU.md:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ (—É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª–∏)" —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ.

---

**User**

–∑–∞—á–µ–º —Ç—ã –ø–∏—Å–∞–ª –ø—Ä–æ –¥–µ–∫–∞–±—Ä—å 2025 –≤ —Ñ–∞–π–ª–µ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º? —Å–µ–π—á–∞—Å 31 –æ–∫—Ç—è–±—Ä—è 2025.

---

**Cursor**


–ò—Å–ø—Ä–∞–≤–ª—è—é –¥–∞—Ç—É –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é: –æ–∫—Ç—è–±—Ä—å 2025.


```markdown
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 31 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 16.0.1

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js 16.0.1 —Å TypeScript
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω PostCSS –∏ Autoprefixer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω ESLint –¥–ª—è Next.js 16
- ‚úÖ –°–æ–∑–¥–∞–Ω `.gitignore`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Header** ‚Äî —à–∞–ø–∫–∞ —Å–∞–π—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é
- ‚úÖ **Footer** ‚Äî –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª–µ–∑–Ω–æ–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)

### Layout
- ‚úÖ `app/layout.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π layout —Å Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è SEO
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω —à—Ä–∏—Ñ—Ç Inter —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (50/50 –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ (–æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ Debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage –∏ fetch

### Dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞
   - ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - [ ] `app/delivery/page.tsx` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - [ ] `app/contacts/page.tsx` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - [ ] Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
   - [ ] –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
   - [ ] –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
   - [ ] FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
   - [ ] –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏–¥–æ–≤:**
   - [ ] `app/api/send-lead/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot
   - [ ] `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: SEO –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
5. **SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
   - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Schema.org)
   - [ ] Sitemap.xml
   - [ ] Robots.txt

6. **–ö–æ–Ω—Ç–µ–Ω—Ç:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ email
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---

## üìã –ó–∞–º–µ—Ç–∫–∏ –∏ –∏–¥–µ–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Next.js 16.0.1 (–≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ—Å—è 16.x –∏–∑-–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- React 19
- Tailwind CSS 3.4.18
- TypeScript 5

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- App Router (Next.js 13+)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `components/`
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C

### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã
1. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ü–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ API ‚Äî —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–µ–∫–∞–±—Ä—å 2025**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ –Ω–∞ React + TypeScript
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ 50/50)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ UX: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –¥–ª—è –±–æ–ª–µ–µ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –≤–∏–¥–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª CALCULATOR_TODO.md —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏

**31.10.2025**
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç —Å Next.js 14 –Ω–∞ Next.js 16.0.1
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (PROGRESS.md)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã" –≤ Header
- ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: Catalog, Calculator, FAQ


```

```markdown
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞: –ì–∞–∑–æ–±–µ—Ç–æ–Ω Online

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 31 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è Next.js:** 16.0.1

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø—Ä–æ–µ–∫—Ç –Ω–∞ Next.js 16.0.1 —Å TypeScript
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω Tailwind CSS —Å —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º–æ–π (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω PostCSS –∏ Autoprefixer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω ESLint –¥–ª—è Next.js 16
- ‚úÖ –°–æ–∑–¥–∞–Ω `.gitignore`

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Header** ‚Äî —à–∞–ø–∫–∞ —Å–∞–π—Ç–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π, –º–æ–±–∏–ª—å–Ω—ã–º –º–µ–Ω—é
- ‚úÖ **Footer** ‚Äî –ø–æ–¥–≤–∞–ª —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ (–∫–∞—Ç–∞–ª–æ–≥, –ø–æ–ª–µ–∑–Ω–æ–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C)

### Layout
- ‚úÖ `app/layout.tsx` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π layout —Å Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è SEO
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω —à—Ä–∏—Ñ—Ç Inter —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π

### –°—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ `app/page.tsx` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏, –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω)
- ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ (16 –≤–æ–ø—Ä–æ—Å–æ–≤)

### –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–¥–µ—Ç–∞–ª—å–Ω–æ)
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ React —Å TypeScript
- ‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –≤–Ω–µ—Å–µ–Ω—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª–µ–π (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (50/50 –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ)
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ (–æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–π —Ü–≤–µ—Ç)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ Debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ localStorage –∏ fetch

### Dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ Dev-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ http://localhost:3000
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
1. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - ‚úÖ `app/catalog/page.tsx` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ `app/calculator/page.tsx` ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—á–µ—Ç–∞
   - ‚úÖ `app/faq/page.tsx` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **–°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   - [ ] `app/delivery/page.tsx` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
   - [ ] `app/contacts/page.tsx` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - [ ] Hero-—Å–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–∏–∑—ã–≤–æ–º
   - [ ] –§–æ—Ä–º–∞ –ø–æ–¥–±–æ—Ä–∞ –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ (–∫–≤–∏–∑)
   - [ ] –ë–ª–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π
   - [ ] –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–æ–º–ø–∞–Ω–∏–∏
   - [ ] FAQ (–∫—Ä–∞—Ç–∫–∞—è –≤–µ—Ä—Å–∏—è, 3-4 –≤–æ–ø—Ä–æ—Å–∞)
   - [ ] –ü—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é (CTA)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏–¥–æ–≤:**
   - [ ] `app/api/send-lead/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot
   - [ ] `app/api/amocrm/route.ts` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å amoCRM

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4: SEO –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
5. **SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - [ ] Open Graph –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π
   - [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (Schema.org)
   - [ ] Sitemap.xml
   - [ ] Robots.txt

6. **–ö–æ–Ω—Ç–µ–Ω—Ç:**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∏ email
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤

---

## üìã –ó–∞–º–µ—Ç–∫–∏ –∏ –∏–¥–µ–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Next.js 16.0.1 (–≤–º–µ—Å—Ç–æ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ—Å—è 16.x –∏–∑-–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- React 19
- Tailwind CSS 3.4.18
- TypeScript 5

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- App Router (Next.js 13+)
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –ø–∞–ø–∫–µ `components/`
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π #EA580C

### –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã
1. –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ü–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ—Å–ª–µ API ‚Äî —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**31.10.2025 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞ –Ω–∞ React + TypeScript
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—Å–æ–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ–∫—É –æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ (—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ 50/50)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ä–∞–∑–º–µ—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ UX: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
- ‚úÖ –£–±—Ä–∞–Ω—ã –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –æ—Ä–∞–Ω–∂–µ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –¥–ª—è –±–æ–ª–µ–µ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –≤–∏–¥–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª CALCULATOR_TODO.md —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –∑–∞–¥–∞—á–∞–º–∏

**31.10.2025**
- ‚úÖ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω –ø—Ä–æ–µ–∫—Ç —Å Next.js 14 –Ω–∞ Next.js 16.0.1
- ‚úÖ –°–æ–∑–¥–∞–Ω —á–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º Header –∏ Footer
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω dev-—Å–µ—Ä–≤–µ—Ä
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (PROGRESS.md)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω Header: —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–±—Ä–∞–Ω –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å—å "–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã" –≤ Header
- ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: Catalog, Calculator, FAQ


```

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ "31 –æ–∫—Ç—è–±—Ä—è 2025"
2. **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**: –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞–∫ "31.10.2025 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)", —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ç–µ –∂–µ —Å—É—Ç–∫–∏, –Ω–æ –ø–æ–∑–∂–µ

–ò–∑–≤–∏–Ω—è—é—Å—å –∑–∞ –æ—à–∏–±–∫—É. –î–∞—Ç—ã —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.

---

**User**

–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –∫–æ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤—ã–Ω–µ—Å–∏ –¥–ª—è –º–µ–Ω—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª

---

**Cursor**


–í—ã–Ω–æ—à—É –∫–æ–¥ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.


–ß–∏—Ç–∞—é –≤–µ—Å—å —Ñ–∞–π–ª –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞, –∑–∞—Ç–µ–º –≤—ã–Ω–µ—Å—É –µ–≥–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:


–í—ã–Ω–æ—à—É –ª–æ–≥–∏–∫—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `components/Calculator.tsx`, –æ—Å—Ç–∞–≤–ª—è—è –≤ `app/calculator/page.tsx` —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã.


```typescriptreact
'use client';

import { useState, useEffect, useCallback, useRef } from 'react';
import Link from 'next/link';

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
const CALCULATION_CONSTANTS = {
  BLOCK_LENGTH: 0.625, // –º–µ—Ç—Ä—ã (625 –º–º)
  BLOCK_HEIGHT: 0.25, // –º–µ—Ç—Ä—ã (250 –º–º)
  RESERVE_PERCENT: 1.05, // 5% –∑–∞–ø–∞—Å
  GLUE_PER_M3: 25, // –∫–≥ –∫–ª–µ—è –Ω–∞ –º¬≥ –∫–ª–∞–¥–∫–∏
  REINFORCEMENT_STEP: 0.75, // —à–∞–≥ –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç—Ä–∞—Ö
  REINFORCEMENT_ROWS: 2, // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤ –∞—Ä–º–∞—Ç—É—Ä—ã
} as const;

// –¶–µ–Ω—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
const REGION_PRICES: Record<string, { block: number; glue: number }> = {
  samara: { block: 6800, glue: 350 },
};

// –¢–∏–ø—ã –¥–ª—è —Ñ–æ—Ä–º—ã
interface CalculatorFormData {
  houseLength: string;
  houseWidth: string;
  perimeter: string;
  wallHeight: string;
  blockThickness: string;
  windowsCount: string;
  windowHeight: string;
  windowWidth: string;
  doorsCount: string;
  doorHeight: string;
  doorWidth: string;
  gableCount: string;
  gableHeight: string;
  gableWidth: string;
  partitionsLength: string;
  partitionsHeight: string;
  partitionsThickness: string;
}

interface CalculationResult {
  blocksCount: number;
  volume: number;
}

interface DetailedCalculationData {
  region: string;
  volume: string;
  blocksCount: number;
  blocksCost: string;
  totalCost: string;
  additionalInfo: string[];
  leadScore: number;
}

type CommunicationMethod = 'whatsapp' | 'telegram' | 'call';
type PurchaseTime = 'urgent' | '1-3months' | 'halfyear' | 'year' | 'browsing';

export default function Calculator() {
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
  const [formData, setFormData] = useState<CalculatorFormData>({
    houseLength: '10',
    houseWidth: '8',
    perimeter: '36',
    wallHeight: '3',
    blockThickness: '400',
    windowsCount: '0',
    windowHeight: '1.5',
    windowWidth: '1.5',
    doorsCount: '0',
    doorHeight: '2.1',
    doorWidth: '0.9',
    gableCount: '0',
    gableHeight: '2',
    gableWidth: '10',
    partitionsLength: '0',
    partitionsHeight: '2.5',
    partitionsThickness: '100',
  });

  const [result, setResult] = useState<CalculationResult>({ blocksCount: 0, volume: 0 });
  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [modalStep, setModalStep] = useState(1);
  const [additionalOptions, setAdditionalOptions] = useState({
    glue: false,
    reinforcement: false,
    delivery: false,
  });
  const [deliveryAddress, setDeliveryAddress] = useState('');
  const [purchaseTime, setPurchaseTime] = useState<PurchaseTime>('1-3months');
  const [communicationMethod, setCommunicationMethod] = useState<CommunicationMethod>('whatsapp');
  const [formFields, setFormFields] = useState({ name: '', phone: '' });
  const [privacyConsent, setPrivacyConsent] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [perimeterEnteredManually, setPerimeterEnteredManually] = useState(false);

  // Lead scoring
  const [leadScore, setLeadScore] = useState(0);
  const sessionStartTime = useRef(Date.now());
  const saveTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined);

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
  useEffect(() => {
    try {
      const saved = localStorage.getItem('calculatorData');
      if (saved) {
        const data = JSON.parse(saved);
        setFormData((prev) => ({ ...prev, ...data }));
        setLeadScore((prev) => prev + 15);
      }
      setLeadScore((prev) => prev + 10); // –ó–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–∏–∑–∏—Ç–∞
    try {
      if (localStorage.getItem('hasVisited')) {
        setLeadScore((prev) => prev + 15);
      } else {
        localStorage.setItem('hasVisited', 'true');
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }, []);

  // –¢–∞–π–º–µ—Ä—ã –¥–ª—è lead scoring
  useEffect(() => {
    const timer1 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 60000);
    const timer2 = setTimeout(() => {
      setLeadScore((prev) => prev + 10);
    }, 180000);

    return () => {
      clearTimeout(timer1);
      clearTimeout(timer2);
    };
  }, []);

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –∏–∑ –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞)
  const calculatePerimeter = useCallback(() => {
    // –ù–µ –≤—ã—á–∏—Å–ª—è–µ–º, –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
    if (perimeterEnteredManually) {
      return;
    }
    const length = parseFloat(formData.houseLength) || 0;
    const width = parseFloat(formData.houseWidth) || 0;
    if (length > 0 && width > 0) {
      const perimeter = (length + width) * 2;
      setFormData((prev) => ({ ...prev, perimeter: perimeter.toString() }));
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–º–µ—Ç—Ä –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—è
      setPerimeterEnteredManually(false);
    } else if (!length && !width) {
      // –ï—Å–ª–∏ –æ–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ, –æ—á–∏—â–∞–µ–º –ø–µ—Ä–∏–º–µ—Ç—Ä –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é
      if (!perimeterEnteredManually) {
        setFormData((prev) => ({ ...prev, perimeter: '' }));
      }
    }
  }, [formData.houseLength, formData.houseWidth, perimeterEnteredManually]);

  // –†–∞—Å—á–µ—Ç —Å debounce –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  const calculateBasic = useCallback(() => {
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;
    const thickness = parseFloat(formData.blockThickness) || 400;

    if (perimeter < 1 || height < 0.1) {
      setResult({ blocksCount: 0, volume: 0 });
      return;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–æ—â–∞–¥—å —Å—Ç–µ–Ω
    const wallArea = perimeter * height;
    const volumeGross = wallArea * (thickness / 1000);

    // –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const windowsCount = parseInt(formData.windowsCount) || 0;
    const windowHeight = parseFloat(formData.windowHeight) || 1.5;
    const windowWidth = parseFloat(formData.windowWidth) || 1.5;
    const windowArea = windowsCount * windowHeight * windowWidth;

    // –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã
    const doorsCount = parseInt(formData.doorsCount) || 0;
    const doorHeight = parseFloat(formData.doorHeight) || 2.1;
    const doorWidth = parseFloat(formData.doorWidth) || 0.9;
    const doorArea = doorsCount * doorHeight * doorWidth;

    // –û–±—ä–µ–º –ø—Ä–æ–µ–º–æ–≤
    const openingsVolume = (windowArea + doorArea) * (thickness / 1000);

    // –§—Ä–æ–Ω—Ç–æ–Ω—ã (—Ç—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ)
    const gableCount = parseInt(formData.gableCount) || 0;
    const gableHeight = parseFloat(formData.gableHeight) || 2;
    const gableWidth = parseFloat(formData.gableWidth) || 10;
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è –ø–ª–æ—â–∞–¥–∏ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞: (—à–∏—Ä–∏–Ω–∞ * –≤—ã—Å–æ—Ç–∞) / 2
    const gablesVolume = gableCount * (0.5 * gableWidth * gableHeight * (thickness / 1000));

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏
    const partitionsLength = parseFloat(formData.partitionsLength) || 0;
    const partitionsHeight = parseFloat(formData.partitionsHeight) || 2.5;
    const partitionsThickness = parseFloat(formData.partitionsThickness) || 100;
    const partitionsVolume = partitionsLength * partitionsHeight * (partitionsThickness / 1000);

    // –ò—Ç–æ–≥–æ–≤—ã–π –æ–±—ä–µ–º
    const volumeNet = volumeGross - openingsVolume + gablesVolume + partitionsVolume;
    const volumeWithReserve = Math.max(0, volumeNet * CALCULATION_CONSTANTS.RESERVE_PERCENT);

    // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤
    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(volumeWithReserve / blockVolume);

    setResult({ blocksCount, volume: volumeWithReserve });
  }, [formData]);

  // –ü–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
  useEffect(() => {
    calculateBasic();
  }, [calculateBasic]);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Å debounce
  const saveToStorage = useCallback(() => {
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }
    saveTimeoutRef.current = setTimeout(() => {
      try {
        localStorage.setItem('calculatorData', JSON.stringify(formData));
      } catch (error) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ localStorage
      }
    }, 500);
  }, [formData]);

  useEffect(() => {
    saveToStorage();
    return () => {
      if (saveTimeoutRef.current) {
        clearTimeout(saveTimeoutRef.current);
      }
    };
  }, [saveToStorage]);

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π
  const handleFieldChange = (field: keyof CalculatorFormData, value: string) => {
    if (field === 'perimeter') {
      // –ü–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–æ–¥–∏—Ç—Å—è –≤—Ä—É—á–Ω—É—é - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥
      setPerimeterEnteredManually(true);
      setFormData((prev) => ({
        ...prev,
        perimeter: value,
        // –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –æ—á–∏—â–∞–µ–º –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É
        houseLength: value ? '' : prev.houseLength,
        houseWidth: value ? '' : prev.houseWidth,
      }));
    } else if (field === 'houseLength' || field === 'houseWidth') {
      setFormData((prev) => ({ ...prev, [field]: value }));
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –¥–ª–∏–Ω—É/—à–∏—Ä–∏–Ω—É, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞
      // —á—Ç–æ–±—ã –ø–µ—Ä–∏–º–µ—Ç—Ä –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –ø–æ–ª—è –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å
      setPerimeterEnteredManually(false);
    } else {
      setFormData((prev) => ({ ...prev, [field]: value }));
    }
    setLeadScore((prev) => prev + 1);
  };

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  const formatPhone = (value: string): string => {
    let digits = value.replace(/\D/g, '');
    
    if (digits.startsWith('8')) {
      digits = '7' + digits.substring(1);
    }
    
    if (digits.startsWith('7')) {
      digits = digits.substring(1);
    }
    
    let formatted = '+7';
    if (digits.length > 0) {
      formatted += ' (' + digits.substring(0, 3);
      if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
        if (digits.length > 6) {
          formatted += '-' + digits.substring(6, 8);
          if (digits.length > 8) {
            formatted += '-' + digits.substring(8, 10);
          }
        }
      }
    }
    
    return formatted;
  };

  // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç)
  const isValidPhone = (phone: string): boolean => {
    const digits = phone.replace(/\D/g, '');
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–æ–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç 10 —Ü–∏—Ñ—Ä (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è 7) –∏–ª–∏ 11 —Ü–∏—Ñ—Ä (—Å 7)
    return (digits.length === 11 && digits.startsWith('7')) || digits.length === 10;
  };

  // –†–∞—Å—á–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
  const calculateDetailed = (): DetailedCalculationData => {
    const region = 'samara';
    const prices = REGION_PRICES[region];
    const thickness = parseFloat(formData.blockThickness) || 400;
    const perimeter = parseFloat(formData.perimeter) || 0;
    const height = parseFloat(formData.wallHeight) || 0;

    const blockVolume = CALCULATION_CONSTANTS.BLOCK_LENGTH * CALCULATION_CONSTANTS.BLOCK_HEIGHT * (thickness / 1000);
    const blocksCount = Math.ceil(result.volume / blockVolume);
    const blocksCost = result.volume * prices.block;

    let additionalCosts = 0;
    const additionalInfo: string[] = [];

    if (additionalOptions.glue) {
      // –†–∞—Å—á–µ—Ç –∫–ª–µ—è: —Ä–∞—Å—Ö–æ–¥ 25 –∫–≥ –Ω–∞ –º¬≥, –º–µ—à–æ–∫ 25 –∫–≥
      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤ = (–æ–±—ä–µ–º * —Ä–∞—Å—Ö–æ–¥ –Ω–∞ –º¬≥) / –≤–µ—Å –º–µ—à–∫–∞
      const glueAmount = Math.ceil(result.volume); // 1 –º–µ—à–æ–∫ –Ω–∞ –º¬≥ (25–∫–≥/–º¬≥ / 25–∫–≥ –º–µ—à–æ–∫ = 1)
      const glueCost = glueAmount * prices.glue;
      additionalCosts += glueCost;
      additionalInfo.push(`–ö–ª–µ–π: ${glueAmount} –º–µ—à–∫–æ–≤ (${glueCost.toLocaleString()} ‚ÇΩ)`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.reinforcement) {
      const reinforcementLength = perimeter * Math.ceil(height / CALCULATION_CONSTANTS.REINFORCEMENT_STEP) * CALCULATION_CONSTANTS.REINFORCEMENT_ROWS;
      additionalInfo.push(`–ê—Ä–º–∞—Ç—É—Ä–∞: ~${Math.round(reinforcementLength)} –º`);
      setLeadScore((prev) => prev + 5);
    }

    if (additionalOptions.delivery) {
      additionalInfo.push(`–î–æ—Å—Ç–∞–≤–∫–∞ –≤ ${deliveryAddress || '—É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å'}: —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ`);
      setLeadScore((prev) => prev + 10);
    }

    return {
      region,
      volume: result.volume.toFixed(1),
      blocksCount,
      blocksCost: blocksCost.toFixed(0),
      totalCost: (blocksCost + additionalCosts).toFixed(0),
      additionalInfo,
      leadScore,
    };
  };

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  const handleSubmit = async () => {
    if (!formFields.name.trim()) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
      return;
    }

    if (!isValidPhone(formFields.phone)) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
      return;
    }

    if (!privacyConsent) {
      alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
      return;
    }

    const timeScores: Record<PurchaseTime, number> = {
      urgent: 30,
      '1-3months': 20,
      halfyear: 10,
      year: 5,
      browsing: 1,
    };

    const finalLeadScore = leadScore + (timeScores[purchaseTime] || 1);
    const leadType =
      finalLeadScore >= 70 ? 'üî• –ì–æ—Ä—è—á–∏–π' : finalLeadScore >= 40 ? 'üå° –¢—ë–ø–ª—ã–π' : '‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω—ã–π';

    const calculationData = calculateDetailed();

    const phoneDigits = formFields.phone.replace(/\D/g, '').replace(/^7/, '');

    const formDataToSend = {
      name: formFields.name.trim(),
      phone: phoneDigits,
      communicationMethod,
      purchaseTime,
      region: 'samara',
      calculation: calculationData,
      leadScore: finalLeadScore,
      leadType,
      timestamp: new Date().toISOString(),
      sessionDuration: Math.round((Date.now() - sessionStartTime.current) / 1000),
      ...formData,
      deliveryAddress,
      additionalOptions,
    };

    setIsSubmitting(true);

    try {
      const SCRIPT_URL =
        'https://script.google.com/macros/s/AKfycbyDKuaQc2g_rT27qMn5X1NJD6-ntn5WStWk5Y50td8CSTlOAxqs81AQO6fpk9Ul6JhC/exec';

      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formDataToSend),
      });

      setTimeout(() => {
        setShowSuccess(true);
        setIsSubmitting(false);
        try {
          localStorage.removeItem('calculatorData');
        } catch (error) {
          // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
        }
      }, 1500);
    } catch (error) {
      setIsSubmitting(false);
      alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    }
  };

  // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
  const openModal = () => {
    setIsModalOpen(true);
    document.body.style.overflow = 'hidden';
    setLeadScore((prev) => prev + 15);
  };

  const closeModal = () => {
    setIsModalOpen(false);
    document.body.style.overflow = 'auto';
    setShowSuccess(false);
    setModalStep(1);
  };

  const nextStep = () => {
    if (modalStep < 3) {
      setModalStep((prev) => prev + 1);
      if (modalStep === 2) {
        calculateDetailed();
      }
    }
  };

  const prevStep = () => {
    if (modalStep > 1) {
      setModalStep((prev) => prev - 1);
    }
  };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –ª–∏ –ø–æ–ª—è –¥–ª–∏–Ω—ã/—à–∏—Ä–∏–Ω—ã (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é)
  const isLengthWidthDisabled = perimeterEnteredManually && !!formData.perimeter;

  return (
    <>
      <div className="container mx-auto px-4 py-6 md:py-12">
        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}
        <div className="text-center mb-8 md:mb-12">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-3 md:mb-4">
            –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≥–∞–∑–æ–±–µ—Ç–æ–Ω–∞
          </h1>
          <p className="text-base md:text-lg text-gray-600">
            –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–∞
          </p>
        </div>

        {/* –°–µ—Ç–∫–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–ª–µ–≤–∞, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–∞ (–Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö) */}
        <div className="max-w-6xl mx-auto grid lg:grid-cols-2 gap-6 lg:gap-8">
          {/* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è */}
          <div className="order-2 lg:order-1">
            <div className="bg-white rounded-xl shadow-sm p-5 lg:sticky lg:top-6">
              <h2 className="text-lg font-bold mb-4 text-gray-900">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?</h2>

              <div className="space-y-4 mb-5">
                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      1
                    </span>
                    <span className="text-sm">–£–∫–∞–∂–∏—Ç–µ —Ä–∞–∑–º–µ—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ–º–∞ –∏–ª–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä —Å—Ç–µ–Ω. –£–∫–∞–∂–∏—Ç–µ –≤—ã—Å–æ—Ç—É —Å—Ç–µ–Ω –∏ —Ç–æ–ª—â–∏–Ω—É –±–ª–æ–∫–æ–≤.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      2
                    </span>
                    <span className="text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —É—á–µ—Ç–∞ –æ–∫–æ–Ω, –¥–≤–µ—Ä–µ–π, —Ñ—Ä–æ–Ω—Ç–æ–Ω–æ–≤ –∏ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–æ–∫.
                  </p>
                </div>

                <div>
                  <h3 className="font-semibold mb-2 flex items-start text-sm">
                    <span className="w-6 h-6 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mr-2 font-bold text-xs flex-shrink-0 mt-0.5">
                      3
                    </span>
                    <span className="text-sm">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                  </h3>
                  <p className="text-gray-600 text-sm ml-8 leading-relaxed">
                    –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤ –∏ –æ–±—ä–µ–º —Å —É—á–µ—Ç–æ–º 5% –∑–∞–ø–∞—Å–∞.
                  </p>
                </div>
              </div>

              <div className="bg-blue-50 border-l-4 border-blue-500 p-3 rounded mb-4">
                <p className="font-semibold text-sm mb-2">üí° –í–∞–∂–Ω–æ:</p>
                <ul className="list-disc pl-4 space-y-1 text-sm text-gray-700">
                  <li>–í—Å–µ –ø—Ä–æ–µ–º—ã –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ —Ä–∞—Å—á–µ—Ç–∞</li>
                  <li>–£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–ø–∞—Å 5%</li>
                  <li>–†–∞—Å—Ö–æ–¥ –∫–ª–µ—è: ~25 –∫–≥/–º¬≥</li>
                </ul>
              </div>

              <div className="bg-orange-50 border border-orange-200 rounded-lg p-3">
                <p className="text-sm text-gray-700 leading-relaxed">
                  <strong className="text-orange-700 block mb-1">–ù—É–∂–µ–Ω —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π?</strong>
                  <span className="text-sm">
                    –ù–∞–∂–º–∏—Ç–µ "–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–º–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
                  </span>
                </p>
              </div>
            </div>
          </div>

          {/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä */}
          <div className="order-1 lg:order-2">
            <div className="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
              {/* Header —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */}
              <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 md:p-8 text-center">
                <h2 className="text-xl md:text-2xl font-bold mb-2">–†–∞—Å—á–µ—Ç –≥–∞–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤</h2>
                <p className="text-sm md:text-base opacity-90">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã</p>
              </div>

              <div className="p-4 md:p-6 lg:p-8">
                {/* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      –î–ª–∏–Ω–∞ –¥–æ–º–∞ (–º)
                    </label>
                    <input
                      type="number"
                      value={formData.houseLength}
                      onChange={(e) => handleFieldChange('houseLength', e.target.value)}
                      onBlur={calculatePerimeter}
                      disabled={isLengthWidthDisabled}
                      min="1"
                      max="50"
                      step="0.5"
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      –®–∏—Ä–∏–Ω–∞ –¥–æ–º–∞ (–º)
                    </label>
                    <input
                      type="number"
                      value={formData.houseWidth}
                      onChange={(e) => handleFieldChange('houseWidth', e.target.value)}
                      onBlur={calculatePerimeter}
                      disabled={isLengthWidthDisabled}
                      min="1"
                      max="50"
                      step="0.5"
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50 disabled:bg-gray-100 disabled:text-gray-500 disabled:cursor-not-allowed"
                    />
                  </div>
                </div>

                <div className="mb-6">
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Å—Ç–µ–Ω (–ø–µ—Ä–∏–º–µ—Ç—Ä, –º)
                  </label>
                  <input
                    type="number"
                    value={formData.perimeter}
                    onChange={(e) => handleFieldChange('perimeter', e.target.value)}
                    min="1"
                    max="200"
                    step="0.5"
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                  />
                  <small className="text-xs text-gray-500 mt-1 block">
                    –ü—Ä–∏ –≤–≤–æ–¥–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞ –ø–æ–ª—è –¥–ª–∏–Ω–∞/—à–∏—Ä–∏–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è
                  </small>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      –í—ã—Å–æ—Ç–∞ —Å—Ç–µ–Ω (–º)
                    </label>
                    <input
                      type="number"
                      value={formData.wallHeight}
                      onChange={(e) => handleFieldChange('wallHeight', e.target.value)}
                      min="2"
                      max="15"
                      step="0.1"
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                      –¢–æ–ª—â–∏–Ω–∞ –±–ª–æ–∫–∞ (–º–º)
                    </label>
                    <select
                      value={formData.blockThickness}
                      onChange={(e) => handleFieldChange('blockThickness', e.target.value)}
                      className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-base transition-all focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20 bg-gray-50"
                    >
                      <option value="200">200 –º–º</option>
                      <option value="250">250 –º–º</option>
                      <option value="300">300 –º–º</option>
                      <option value="375">375 –º–º</option>
                      <option value="400">400 –º–º</option>
                    </select>
                  </div>
                </div>

                {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã */}
                <div className="mb-6 text-center">
                  <button
                    type="button"
                    onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}
                    className="bg-blue-50 hover:bg-blue-100 border-2 border-blue-600 text-blue-600 font-semibold px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2 mx-auto"
                  >
                    <span>{isAdvancedOpen ? '‚ñ≤' : '‚ñº'}</span>
                    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                  </button>

                  {isAdvancedOpen && (
                    <div className="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-4">
                      {/* –û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                      <div>
                        <h4 className="text-sm font-semibold text-gray-700 mb-3">–û–∫–æ–Ω–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                            <input
                              type="number"
                              value={formData.windowsCount}
                              onChange={(e) => handleFieldChange('windowsCount', e.target.value)}
                              min="0"
                              max="50"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.windowHeight}
                              onChange={(e) => handleFieldChange('windowHeight', e.target.value)}
                              min="0.5"
                              max="5"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.windowWidth}
                              onChange={(e) => handleFieldChange('windowWidth', e.target.value)}
                              min="0.5"
                              max="5"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                        </div>
                      </div>

                      {/* –î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã */}
                      <div>
                        <h4 className="text-sm font-semibold text-gray-700 mb-3">–î–≤–µ—Ä–Ω—ã–µ –ø—Ä–æ–µ–º—ã</h4>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                            <input
                              type="number"
                              value={formData.doorsCount}
                              onChange={(e) => handleFieldChange('doorsCount', e.target.value)}
                              min="0"
                              max="20"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.doorHeight}
                              onChange={(e) => handleFieldChange('doorHeight', e.target.value)}
                              min="1"
                              max="3"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.doorWidth}
                              onChange={(e) => handleFieldChange('doorWidth', e.target.value)}
                              min="0.5"
                              max="3"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                        </div>
                      </div>

                      {/* –§—Ä–æ–Ω—Ç–æ–Ω—ã */}
                      <div>
                        <h4 className="text-sm font-semibold text-gray-700 mb-3">–§—Ä–æ–Ω—Ç–æ–Ω—ã</h4>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç)</label>
                            <input
                              type="number"
                              value={formData.gableCount}
                              onChange={(e) => handleFieldChange('gableCount', e.target.value)}
                              min="0"
                              max="10"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.gableHeight}
                              onChange={(e) => handleFieldChange('gableHeight', e.target.value)}
                              min="0.5"
                              max="10"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–®–∏—Ä–∏–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏—è (–º)</label>
                            <input
                              type="number"
                              value={formData.gableWidth}
                              onChange={(e) => handleFieldChange('gableWidth', e.target.value)}
                              min="1"
                              max="50"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                        </div>
                      </div>

                      {/* –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ */}
                      <div>
                        <h4 className="text-sm font-semibold text-gray-700 mb-3">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏</h4>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–î–ª–∏–Ω–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.partitionsLength}
                              onChange={(e) => handleFieldChange('partitionsLength', e.target.value)}
                              min="0"
                              max="200"
                              step="0.5"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–í—ã—Å–æ—Ç–∞ (–º)</label>
                            <input
                              type="number"
                              value={formData.partitionsHeight}
                              onChange={(e) => handleFieldChange('partitionsHeight', e.target.value)}
                              min="1"
                              max="5"
                              step="0.1"
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            />
                          </div>
                          <div>
                            <label className="block text-xs text-gray-600 mb-1">–¢–æ–ª—â–∏–Ω–∞ (–º–º)</label>
                            <select
                              value={formData.partitionsThickness}
                              onChange={(e) => handleFieldChange('partitionsThickness', e.target.value)}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:border-orange-600"
                            >
                              <option value="100">100 –º–º</option>
                              <option value="150">150 –º–º</option>
                              <option value="200">200 –º–º</option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                </div>

                {/* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */}
                <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-orange-600 rounded-xl p-6 mb-6">
                  <div className="space-y-4">
                    <div className="flex justify-between items-center pb-3 border-b border-blue-200">
                      <span className="font-semibold text-gray-700">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤:</span>
                      <span className="font-bold text-xl text-gray-900">{result.blocksCount} —à—Ç</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="font-semibold text-gray-700">–û–±—ä–µ–º:</span>
                      <span className="font-bold text-xl text-gray-900">{result.volume.toFixed(1)} –º¬≥</span>
                    </div>
                  </div>
                  <div
                    onClick={openModal}
                    className="mt-4 bg-yellow-50 border-2 border-dashed border-orange-600 rounded-lg p-4 text-center cursor-pointer transition-all hover:bg-orange-600 hover:text-white hover:border-orange-700 hover:transform hover:-translate-y-0.5"
                  >
                    <strong className="text-base">üí∞ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π</strong>
                  </div>
                </div>

                <p className="text-center text-sm text-gray-600 mb-6">
                  –ß—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ, —Å —É—á–µ—Ç–æ–º –∫–ª–µ—è, –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏,
                  —É—Ç–æ—á–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Üí
                </p>

                <button
                  onClick={openModal}
                  className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 uppercase tracking-wide disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none"
                >
                  üìä –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */}
      {isModalOpen && (
        <div
          className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4"
          onClick={(e) => {
            if (e.target === e.currentTarget) closeModal();
          }}
        >
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            {/* Header –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */}
            <div className="bg-gradient-to-r from-navy-900 to-navy-700 text-white p-6 flex justify-between items-center rounded-t-2xl">
              <h2 className="text-xl md:text-2xl font-bold">–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
              <button
                onClick={closeModal}
                className="text-2xl hover:text-orange-400 transition-colors"
                aria-label="–ó–∞–∫—Ä—ã—Ç—å"
              >
                √ó
              </button>
            </div>

            <div className="p-6 md:p-8">
              {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ */}
              <div className="flex justify-center mb-8 gap-4">
                {[1, 2, 3].map((step) => (
                  <div
                    key={step}
                    className={`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${
                      step < modalStep
                        ? 'bg-green-500 text-white'
                        : step === modalStep
                          ? 'bg-orange-600 text-white'
                          : 'bg-gray-200 text-gray-500'
                    }`}
                  >
                    {step}
                  </div>
                ))}
              </div>

              {/* –®–∞–≥ 1 */}
              {modalStep === 1 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–£—Ç–æ—á–Ω–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –£—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
                    –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
                  </p>

                  <div className="space-y-3 mb-6">
                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.glue}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, glue: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—á–µ—Ç –∫–ª–µ—è</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.reinforcement}
                        onChange={(e) =>
                          setAdditionalOptions((prev) => ({ ...prev, reinforcement: e.target.checked }))
                        }
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∞—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                    </label>

                    <label className="flex items-center gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors">
                      <input
                        type="checkbox"
                        checked={additionalOptions.delivery}
                        onChange={(e) => {
                          setAdditionalOptions((prev) => ({ ...prev, delivery: e.target.checked }));
                          if (!e.target.checked) setDeliveryAddress('');
                        }}
                        className="w-5 h-5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="font-medium">–ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞</span>
                    </label>

                    {additionalOptions.delivery && (
                      <div className="mt-3 ml-8">
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
                        </label>
                        <input
                          type="text"
                          value={deliveryAddress}
                          onChange={(e) => setDeliveryAddress(e.target.value)}
                          placeholder="–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥/–Ω–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-600"
                        />
                      </div>
                    )}
                  </div>

                  <button
                    onClick={nextStep}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –î–∞–ª–µ–µ ‚Üí
                  </button>
                </div>
              )}

              {/* –®–∞–≥ 2 */}
              {modalStep === 2 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü–ª–∞–Ω—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –ø–ª–∞–Ω–∞–º–∏, –º—ã –ø—Ä–∏—à–ª–µ–º –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–ª—è –í–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="mb-6">
                    <label className="block text-sm font-semibold text-gray-700 mb-3">
                      –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–∫—É–ø–∫—É:
                    </label>
                    <div className="space-y-2">
                      {[
                        { value: 'urgent', label: '–°—Ä–æ—á–Ω–æ / –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è' },
                        { value: '1-3months', label: '–í —Ç–µ—á–µ–Ω–∏–∏ 1-3 –º–µ—Å—è—Ü–µ–≤' },
                        { value: 'halfyear', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –ø–æ–ª—É–≥–æ–¥–∞' },
                        { value: 'year', label: '–í —Ç–µ—á–µ–Ω–∏–∏ –≥–æ–¥–∞' },
                        { value: 'browsing', label: '–ü–æ–∫–∞ –ø—Ä–∏—Ü–µ–Ω–∏–≤–∞—é—Å—å' },
                      ].map((option) => (
                        <label
                          key={option.value}
                          className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors"
                        >
                          <input
                            type="radio"
                            name="purchaseTime"
                            value={option.value}
                            checked={purchaseTime === option.value}
                            onChange={(e) => setPurchaseTime(e.target.value as PurchaseTime)}
                            className="w-4 h-4 text-orange-600 focus:ring-orange-500"
                          />
                          <span>{option.label}</span>
                        </label>
                      ))}
                    </div>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={nextStep}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                    >
                      –î–∞–ª–µ–µ ‚Üí
                    </button>
                  </div>
                </div>
              )}

              {/* –®–∞–≥ 3 */}
              {modalStep === 3 && !showSuccess && (
                <div>
                  <h3 className="text-xl font-bold mb-4">–ü—Ä–∏—à–ª–µ–º —Ä–∞—Å—á–µ—Ç –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–∏–≥—É</h3>
                  <p className="text-gray-600 mb-6 leading-relaxed">
                    –ù–∏–∫–∞–∫–∏—Ö –Ω–∞–≤—è–∑—á–∏–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ - –æ—Ç–ø—Ä–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —É–¥–æ–±–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä.
                  </p>

                  <div className="bg-blue-50 rounded-lg p-5 mb-6 space-y-3">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ü–µ–Ω 3 –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –≤ –í–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <strong>–ë–û–ù–£–°:</strong>
                      <span>
                        –ö–Ω–∏–≥–∞ "–°—Ç—Ä–æ–∏–º –ø—Ä–æ—Å—Ç–æ!" - –∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ–º –∏ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç
                        800.000 —Ä—É–±–ª–µ–π?
                      </span>
                    </div>
                  </div>

                  <div className="space-y-4 mb-6">
                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –í–∞—à–µ –∏–º—è *
                      </label>
                      <input
                        type="text"
                        value={formFields.name}
                        onChange={(e) => setFormFields((prev) => ({ ...prev, name: e.target.value }))}
                        placeholder="–ö–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è?"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-2">
                        –¢–µ–ª–µ—Ñ–æ–Ω *
                      </label>
                      <input
                        type="tel"
                        value={formFields.phone}
                        onChange={(e) => {
                          const formatted = formatPhone(e.target.value);
                          setFormFields((prev) => ({ ...prev, phone: formatted }));
                        }}
                        placeholder="+7 (___) ___-__-__"
                        required
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-orange-600 focus:ring-2 focus:ring-orange-600/20"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-semibold text-gray-700 mb-3">
                        –£–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏:
                      </label>
                      <div className="flex gap-3 flex-wrap">
                        {[
                          { value: 'whatsapp', label: 'üì± WhatsApp' },
                          { value: 'telegram', label: '‚úàÔ∏è Telegram' },
                          { value: 'call', label: 'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å' },
                        ].map((method) => (
                          <button
                            key={method.value}
                            type="button"
                            onClick={() => setCommunicationMethod(method.value as CommunicationMethod)}
                            className={`px-4 py-2 rounded-lg border-2 transition-all ${
                              communicationMethod === method.value
                                ? 'bg-orange-600 border-orange-600 text-white font-semibold'
                                : 'bg-white border-gray-300 text-gray-700 hover:border-orange-600'
                            }`}
                          >
                            {method.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    <label className="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={privacyConsent}
                        onChange={(e) => setPrivacyConsent(e.target.checked)}
                        required
                        className="w-5 h-5 mt-0.5 text-orange-600 focus:ring-orange-500"
                      />
                      <span className="text-sm text-gray-700">
                        –°–æ–≥–ª–∞—Å–µ–Ω —Å{' '}
                        <Link href="/confidence/" target="_blank" className="text-orange-600 hover:underline">
                          –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
                        </Link>
                      </span>
                    </label>
                  </div>

                  <div className="flex gap-4">
                    <button
                      onClick={prevStep}
                      className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-4 rounded-xl transition-colors"
                    >
                      ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button
                      onClick={handleSubmit}
                      disabled={isSubmitting}
                      className="flex-[2] bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl disabled:opacity-60 disabled:cursor-not-allowed"
                    >
                      {isSubmitting ? '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...' : 'üéÅ –ü–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—á–µ—Ç'}
                    </button>
                  </div>
                </div>
              )}

              {/* –≠–∫—Ä–∞–Ω —É—Å–ø–µ—Ö–∞ */}
              {showSuccess && (
                <div className="text-center py-8">
                  <div className="text-6xl mb-6">üéâ</div>
                  <h2 className="text-2xl font-bold mb-6">–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞—Å—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!</h2>
                  <div className="bg-blue-50 rounded-lg p-6 mb-6 space-y-3 text-left">
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –ö–Ω–∏–≥–∞ "–ö–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å –æ—Ç 800.000‚ÇΩ –Ω–∞ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ" - –ø—Ä–∏—à–ª–µ–º —Å—Å—ã–ª–∫—É –Ω–∞
                        —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
                      </span>
                    </div>
                    <div className="flex items-center gap-2">
                      <span>‚úÖ</span>
                      <span>
                        –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç —Å–∞–º—ã–π –≤—ã–≥–æ–¥–Ω—ã–π –¥–ª—è –í–∞—Å –≤–∞—Ä–∏–∞–Ω—Ç –∏
                        —Å–≤—è–∂–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º!
                      </span>
                    </div>
                  </div>
                  <button
                    onClick={closeModal}
                    className="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl"
                  >
                    –û—Ç–ª–∏—á–Ω–æ!
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      )}
    </>
  );
}

```

